name: Deploy Docs

on:
    push:
        branches: [master]
        paths:
            - 'docs/**'
    workflow_dispatch:

permissions:
    contents: write

jobs:
    build-and-deploy:
        runs-on: ubuntu-latest
        steps:
            - name: Checkout
              uses: actions/checkout@v4

            - name: Setup Node.js
              uses: actions/setup-node@v4
              with:
                  node-version: 20
                  cache: yarn

            - name: Install dependencies
              run: |
                  yarn install --frozen-lockfile
                  cd docs && yarn install --frozen-lockfile

            - name: Build docs
              env:
                  VITEPRESS_BASE: /noorm/
              run: cd docs && yarn build

            - name: Deploy to gh-pages
              run: |
                  cd docs/.vitepress/dist
                  git init
                  git config user.name "GitHub Actions"
                  git config user.email "actions@github.com"
                  git add -A
                  git commit -m "Deploy docs from ${{ github.sha }}"
                  git push -f https://x-access-token:${{ secrets.GITHUB_TOKEN }}@github.com/${{ github.repository }}.git HEAD:gh-pages
