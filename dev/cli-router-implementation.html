<!DOCTYPE html>
<html lang="en-US" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Building a CLI Router for Ink | noorm</title>
    <meta name="description" content="Database Schema & Change Manager">
    <meta name="generator" content="VitePress v2.0.0-alpha.15">
    <link rel="preload stylesheet" href="/assets/style.BY1_EUBl.css" as="style">
    <link rel="preload stylesheet" href="/vp-icons.css" as="style">
    
    <script type="module" src="/assets/app.nXpzwUTN.js"></script>
    <link rel="preload" href="/assets/inter-roman-latin.Di8DUHzh.woff2" as="font" type="font/woff2" crossorigin="">
    <link rel="modulepreload" href="/assets/chunks/framework.YF6eQPX_.js">
    <link rel="modulepreload" href="/assets/chunks/theme.CgPUS6I8.js">
    <link rel="modulepreload" href="/assets/dev_cli-router-implementation.md.CSMrh0qO.lean.js">
    <link rel="icon" href="/image/logo.png">
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-Y69K95866J"></script>
    <script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag("js",new Date),gtag("config","G-Y69K95866J");</script>
    <script id="check-dark-mode">(()=>{const e=localStorage.getItem("vitepress-theme-appearance")||"auto",a=window.matchMedia("(prefers-color-scheme: dark)").matches;(!e||e==="auto"?a:e==="dark")&&document.documentElement.classList.add("dark")})();</script>
    <script id="check-mac-os">document.documentElement.classList.toggle("mac",/Mac|iPhone|iPod|iPad/i.test(navigator.platform));</script>
  </head>
  <body>
    <div id="app"><div class="Layout" data-v-304c8b69><!--[--><!--]--><!--[--><span tabindex="-1" data-v-10d4d845></span><a href="#VPContent" class="VPSkipLink visually-hidden" data-v-10d4d845>Skip to content</a><!--]--><!----><header class="VPNav" data-v-304c8b69 data-v-604a0865><div class="VPNavBar" data-v-604a0865 data-v-18128346><div class="wrapper" data-v-18128346><div class="container" data-v-18128346><div class="title" data-v-18128346><div class="VPNavBarTitle has-sidebar" data-v-18128346 data-v-d4488dd0><a class="title" href="/" data-v-d4488dd0><!--[--><!--]--><!--[--><img class="VPImage logo" src="/image/logo.png" alt data-v-ab19afbb><!--]--><span data-v-d4488dd0>noorm</span><!--[--><!--]--></a></div></div><div class="content" data-v-18128346><div class="content-body" data-v-18128346><!--[--><!--]--><div class="VPNavBarSearch search" data-v-18128346><!--[--><!----><div id="local-search"><button type="button" aria-label="Search" aria-keyshortcuts="/ control+k meta+k" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><span class="vpi-search DocSearch-Search-Icon"></span><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"><kbd class="DocSearch-Button-Key"></kbd><kbd class="DocSearch-Button-Key"></kbd></span></button></div><!--]--></div><nav aria-labelledby="main-nav-aria-label" class="VPNavBarMenu menu" data-v-18128346 data-v-020be4db><span id="main-nav-aria-label" class="visually-hidden" data-v-020be4db> Main Navigation </span><!--[--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Home</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/getting-started/installation.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Getting Started</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/guide/sql-files/organization.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Guide</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/tui.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>TUI</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/headless.html" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Headless</span><!--]--></a><!--]--><!--[--><a class="VPLink link VPNavBarMenuLink" href="/dev/" tabindex="0" data-v-020be4db data-v-81dba28a><!--[--><span data-v-81dba28a>Dev Docs</span><!--]--></a><!--]--><!--]--></nav><!----><div class="VPNavBarAppearance appearance" data-v-18128346 data-v-3f90c1a5><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-3f90c1a5 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div><div class="VPSocialLinks VPNavBarSocialLinks social-links" data-v-18128346 data-v-ef6192dc data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/noormdev/noorm" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div><div class="VPFlyout VPNavBarExtra extra" data-v-18128346 data-v-600b50c9 data-v-d8fae6e2><button type="button" class="button" aria-haspopup="true" aria-expanded="false" aria-label="extra navigation" data-v-d8fae6e2><span class="vpi-more-horizontal icon" data-v-d8fae6e2></span></button><div class="menu" data-v-d8fae6e2><div class="VPMenu" data-v-d8fae6e2 data-v-fcd1d7a8><!----><!--[--><!--[--><!----><div class="group" data-v-600b50c9><div class="item appearance" data-v-600b50c9><p class="label" data-v-600b50c9>Appearance</p><div class="appearance-action" data-v-600b50c9><button class="VPSwitch VPSwitchAppearance" type="button" role="switch" title aria-checked="false" data-v-600b50c9 data-v-be9742d9 data-v-b4ccac88><span class="check" data-v-b4ccac88><span class="icon" data-v-b4ccac88><!--[--><span class="vpi-sun sun" data-v-be9742d9></span><span class="vpi-moon moon" data-v-be9742d9></span><!--]--></span></span></button></div></div></div><div class="group" data-v-600b50c9><div class="item social-links" data-v-600b50c9><div class="VPSocialLinks social-links-list" data-v-600b50c9 data-v-a1a7286e><!--[--><a class="VPSocialLink no-icon" href="https://github.com/noormdev/noorm" aria-label="github" target="_blank" rel="me noopener" data-v-a1a7286e data-v-32d78712><span class="vpi-social-github"></span></a><!--]--></div></div></div><!--]--><!--]--></div></div></div><!--[--><!--]--><button type="button" class="VPNavBarHamburger hamburger" aria-label="mobile navigation" aria-expanded="false" aria-controls="VPNavScreen" data-v-18128346 data-v-6bee1efd><span class="container" data-v-6bee1efd><span class="top" data-v-6bee1efd></span><span class="middle" data-v-6bee1efd></span><span class="bottom" data-v-6bee1efd></span></span></button></div></div></div></div><div class="divider" data-v-18128346><div class="divider-line" data-v-18128346></div></div></div><!----></header><div class="VPLocalNav has-sidebar empty" data-v-304c8b69 data-v-73add737><div class="container" data-v-73add737><button class="menu" aria-expanded="false" aria-controls="VPSidebarNav" data-v-73add737><span class="vpi-align-left menu-icon" data-v-73add737></span><span class="menu-text" data-v-73add737>Menu</span></button><div class="VPLocalNavOutlineDropdown" style="--vp-vh:0px;" data-v-73add737 data-v-e28a51a6><button data-v-e28a51a6>Return to top</button><!----></div></div></div><aside class="VPSidebar" data-v-304c8b69 data-v-49f51a23><div class="curtain" data-v-49f51a23></div><nav class="nav" id="VPSidebarNav" aria-labelledby="sidebar-aria-label" tabindex="-1" data-v-49f51a23><span class="visually-hidden" id="sidebar-aria-label" data-v-49f51a23> Sidebar Navigation </span><!--[--><!--]--><!--[--><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Core Modules</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Overview</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/change.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Change Management</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/config.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Configuration</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/runner.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Runner</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/settings.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Settings</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/state.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>State</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Features</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/explore.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Database Explorer</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/sql-terminal.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>SQL Terminal</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/template.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Templates</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/secrets.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Secrets</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/lock.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Locking</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/teardown.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Teardown</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/config-sharing.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Config Sharing</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Integration</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/sdk.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>SDK</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/headless.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Headless Mode</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/ci.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>CI/CD</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/identity.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Identity</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><div class="no-transition group" data-v-a84b7c21><section class="VPSidebarItem level-0" data-v-a84b7c21 data-v-6b36a2fd><div class="item" role="button" tabindex="0" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><h2 class="text" data-v-6b36a2fd>Reference</h2><!----></div><div class="items" data-v-6b36a2fd><!--[--><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/datamodel.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Data Model</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/logger.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Logger</p><!--]--></a><!----></div><!----></div><div class="VPSidebarItem level-1 is-link" data-v-6b36a2fd data-v-6b36a2fd><div class="item" data-v-6b36a2fd><div class="indicator" data-v-6b36a2fd></div><a class="VPLink link link" href="/dev/version.html" data-v-6b36a2fd><!--[--><p class="text" data-v-6b36a2fd>Versioning</p><!--]--></a><!----></div><!----></div><!--]--></div></section></div><!--]--><!--[--><!--]--></nav></aside><div class="VPContent has-sidebar" id="VPContent" data-v-304c8b69 data-v-bd4f21ea><div class="VPDoc has-sidebar has-aside" data-v-bd4f21ea data-v-d668f7cc><!--[--><!--]--><div class="container" data-v-d668f7cc><div class="aside" data-v-d668f7cc><div class="aside-curtain" data-v-d668f7cc></div><div class="aside-container" data-v-d668f7cc><div class="aside-content" data-v-d668f7cc><div class="VPDocAside" data-v-d668f7cc data-v-cb998dce><!--[--><!--]--><!--[--><!--]--><nav aria-labelledby="doc-outline-aria-label" class="VPDocAsideOutline" data-v-cb998dce data-v-c8b19031><div class="content" data-v-c8b19031><div class="outline-marker" data-v-c8b19031></div><div aria-level="2" class="outline-title" id="doc-outline-aria-label" role="heading" data-v-c8b19031>On this page</div><ul class="VPDocOutlineItem root" data-v-c8b19031 data-v-63c57e50><!--[--><!--]--></ul></div></nav><!--[--><!--]--><div class="spacer" data-v-cb998dce></div><!--[--><!--]--><!----><!--[--><!--]--><!--[--><!--]--></div></div></div></div><div class="content" data-v-d668f7cc><div class="content-container" data-v-d668f7cc><!--[--><!--]--><main class="main" data-v-d668f7cc><div style="position:relative;" class="vp-doc _dev_cli-router-implementation" data-v-d668f7cc><div><h1 id="building-a-cli-router-for-ink" tabindex="-1">Building a CLI Router for Ink <a class="header-anchor" href="#building-a-cli-router-for-ink" aria-label="Permalink to “Building a CLI Router for Ink”">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to “Overview”">​</a></h2><p>This document outlines architectural patterns for implementing a custom CLI router for an Ink-based TUI application. Since Pastel (the Next.js-inspired framework for Ink) is incompatible with Ink v6, we need our own lightweight router that provides:</p><ol><li><strong>CLI argument parsing</strong> - Map shell commands to routes</li><li><strong>In-app navigation</strong> - Navigate between screens with history</li><li><strong>Screen rendering</strong> - Render the correct component for each route</li><li><strong>Dual-mode support</strong> - TUI mode and headless mode for CI/CD</li></ol><h2 id="architecture-comparison" tabindex="-1">Architecture Comparison <a class="header-anchor" href="#architecture-comparison" aria-label="Permalink to “Architecture Comparison”">​</a></h2><h3 id="pastel-s-approach" tabindex="-1">Pastel&#39;s Approach <a class="header-anchor" href="#pastel-s-approach" aria-label="Permalink to “Pastel&#39;s Approach”">​</a></h3><p>Pastel uses file-based routing (like Next.js):</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>commands/</span></span>
<span class="line"><span>├── index.tsx           → mycli</span></span>
<span class="line"><span>├── config.tsx          → mycli config</span></span>
<span class="line"><span>└── config/</span></span>
<span class="line"><span>    ├── add.tsx         → mycli config add</span></span>
<span class="line"><span>    └── edit.tsx        → mycli config edit &lt;name&gt;</span></span></code></pre></div><p><strong>Pros:</strong> Convention over configuration, auto-discovery <strong>Cons:</strong> Requires build step, file system coupling, magic</p><h3 id="our-approach-explicit-registry" tabindex="-1">Our Approach: Explicit Registry <a class="header-anchor" href="#our-approach-explicit-registry" aria-label="Permalink to “Our Approach: Explicit Registry”">​</a></h3><p>We use an explicit route registry with meow for CLI parsing:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>src/cli/</span></span>
<span class="line"><span>├── index.tsx           # Entry point + meow setup</span></span>
<span class="line"><span>├── router.tsx          # React context for navigation</span></span>
<span class="line"><span>├── screens.tsx         # Route → Component registry</span></span>
<span class="line"><span>└── screens/</span></span>
<span class="line"><span>    ├── home.tsx</span></span>
<span class="line"><span>    ├── config/</span></span>
<span class="line"><span>    │   ├── list.tsx</span></span>
<span class="line"><span>    │   ├── add.tsx</span></span>
<span class="line"><span>    │   └── edit.tsx</span></span>
<span class="line"><span>    └── ...</span></span></code></pre></div><p><strong>Pros:</strong> Type-safe, explicit, no magic, works with any bundler <strong>Cons:</strong> Manual registration required</p><h2 id="core-concepts" tabindex="-1">Core Concepts <a class="header-anchor" href="#core-concepts" aria-label="Permalink to “Core Concepts”">​</a></h2><h3 id="route-types" tabindex="-1">Route Types <a class="header-anchor" href="#route-types" aria-label="Permalink to “Route Types”">​</a></h3><p>Define a union type of all valid routes for compile-time safety:</p><ul><li>Use string literal unions for route names (e.g., <code>&#39;home&#39; | &#39;config&#39; | &#39;config/add&#39;</code>)</li><li>Consider hierarchical naming with <code>/</code> separators to group related routes</li><li>Define a <code>RouteParams</code> interface for dynamic parameters (name, path, count, etc.)</li><li>Track navigation history as an array of <code>{ route, params }</code> entries</li></ul><h3 id="router-context" tabindex="-1">Router Context <a class="header-anchor" href="#router-context" aria-label="Permalink to “Router Context”">​</a></h3><p>The router should be implemented as a React context that manages:</p><ul><li><strong>Current route</strong> - The active route string</li><li><strong>Route params</strong> - Dynamic parameters for the current route</li><li><strong>History stack</strong> - Previous routes for back navigation</li></ul><p>Key actions to expose:</p><ul><li><code>navigate(route, params)</code> - Push a new route onto history</li><li><code>back()</code> - Pop and navigate to previous route</li><li><code>replace(route, params)</code> - Replace current route without history</li><li><code>reset()</code> - Clear history and return to home</li></ul><p><strong>Deep Route Initialization</strong></p><p>When the CLI starts with a deep route (e.g., <code>noorm settings/secrets/add</code>), the router builds ancestral history automatically. This ensures back navigation works correctly:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>Initial route: &#39;settings/secrets/add&#39;</span></span>
<span class="line"><span>Built history: [&#39;home&#39;, &#39;settings&#39;, &#39;settings/secrets&#39;]</span></span></code></pre></div><p>The <code>buildAncestorHistory</code> function uses <code>getParentRoute</code> to walk up the route hierarchy, building the stack so pressing Escape navigates through parents correctly.</p><h3 id="provider-hierarchy" tabindex="-1">Provider Hierarchy <a class="header-anchor" href="#provider-hierarchy" aria-label="Permalink to “Provider Hierarchy”">​</a></h3><p>The app requires a specific nesting order for providers:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>ShutdownProvider      # Lifecycle management, graceful exit</span></span>
<span class="line"><span>└── AppContextProvider    # State/settings orchestration, observer subscriptions</span></span>
<span class="line"><span>    └── ToastProvider     # Toast notifications</span></span>
<span class="line"><span>        └── FocusProvider     # Focus stack management</span></span>
<span class="line"><span>            └── RouterProvider    # Navigation state</span></span>
<span class="line"><span>                └── GlobalKeyboard    # Ctrl+C, Escape handling</span></span>
<span class="line"><span>                    └── AppShell      # Screen rendering</span></span></code></pre></div><p>Key providers:</p><ul><li><strong>ShutdownProvider</strong> - Manages <code>LifecycleManager</code>, provides <code>useShutdown()</code> hook</li><li><strong>AppContextProvider</strong> - Loads state/settings, subscribes to observer events</li><li><strong>ToastProvider</strong> - Toast queue with <code>useToast()</code> hook</li><li><strong>FocusProvider</strong> - Custom focus stack (not Ink&#39;s built-in focus)</li></ul><h3 id="screen-registry" tabindex="-1">Screen Registry <a class="header-anchor" href="#screen-registry" aria-label="Permalink to “Screen Registry”">​</a></h3><p>Map routes to React components using a simple record:</p><ul><li>Consider <code>React.lazy()</code> for code-splitting in larger apps</li><li>Direct imports work fine for smaller CLIs</li><li>Wrap rendering in <code>React.Suspense</code> for lazy-loaded screens</li><li>Handle unknown routes gracefully with an error screen</li></ul><h3 id="cli-entry-point-with-meow" tabindex="-1">CLI Entry Point with meow <a class="header-anchor" href="#cli-entry-point-with-meow" aria-label="Permalink to “CLI Entry Point with meow”">​</a></h3><p>Use <a href="https://github.com/sindresorhus/meow" target="_blank" rel="noreferrer">meow</a> for CLI argument parsing. Meow provides:</p><ul><li>Automatic help text generation</li><li>Flag parsing with type coercion</li><li>Version display from package.json</li><li>camelCase flag conversion</li></ul><p><strong>Pattern: Subcommand Routing</strong></p><p>Since meow doesn&#39;t have built-in subcommand support like Commander, route based on positional arguments:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>mycli                    → input: []           → route: &#39;home&#39;</span></span>
<span class="line"><span>mycli config             → input: [&#39;config&#39;]   → route: &#39;config&#39;</span></span>
<span class="line"><span>mycli config add         → input: [&#39;config&#39;, &#39;add&#39;] → route: &#39;config/add&#39;</span></span>
<span class="line"><span>mycli config edit foo    → input: [&#39;config&#39;, &#39;edit&#39;, &#39;foo&#39;] → route: &#39;config/edit&#39;, params: { name: &#39;foo&#39; }</span></span></code></pre></div><p><strong>Suggested approach:</strong></p><ol><li>Parse <code>cli.input</code> array to determine the route</li><li>Extract remaining positional args as route parameters</li><li>Pass <code>cli.flags</code> as additional context (headless mode, verbose, etc.)</li><li>Start the app with resolved route and params</li></ol><h2 id="advanced-patterns" tabindex="-1">Advanced Patterns <a class="header-anchor" href="#advanced-patterns" aria-label="Permalink to “Advanced Patterns”">​</a></h2><h3 id="global-keyboard-handler" tabindex="-1">Global Keyboard Handler <a class="header-anchor" href="#global-keyboard-handler" aria-label="Permalink to “Global Keyboard Handler”">​</a></h3><p>Add consistent keyboard shortcuts across all screens:</p><ul><li><code>q</code> to quit the application</li><li><code>Escape</code> to go back (when history exists)</li><li>Consider a wrapper component that uses Ink&#39;s <code>useInput</code> hook</li><li>Prevent duplicate handlers by managing focus appropriately</li></ul><p>Available keyboard helper hooks in <code>src/cli/keyboard.tsx</code>:</p><ul><li><strong><code>useFocusedInput(isFocused, handler)</code></strong> - Wraps <code>useInput</code> with focus checking</li><li><strong><code>useListKeys(options)</code></strong> - List navigation (up/down, enter selection)</li><li><strong><code>useQuitHandler()</code></strong> - Graceful shutdown on Ctrl+C</li></ul><h3 id="headless-mode-for-ci-cd" tabindex="-1">Headless Mode for CI/CD <a class="header-anchor" href="#headless-mode-for-ci-cd" aria-label="Permalink to “Headless Mode for CI/CD”">​</a></h3><p>Support non-interactive execution for scripts and CI pipelines:</p><ul><li>Detect headless mode via <code>process.env.CI</code> or <code>!process.stdout.isTTY</code></li><li>Allow explicit <code>--headless</code> flag override</li><li>In headless mode, execute commands directly and output JSON/text to stdout</li><li>Skip TUI rendering entirely in headless mode</li></ul><h3 id="route-guards" tabindex="-1">Route Guards <a class="header-anchor" href="#route-guards" aria-label="Permalink to “Route Guards”">​</a></h3><p>Add logic that runs before navigation:</p><ul><li>Validate required params exist before allowing navigation</li><li>Redirect to fallback routes when guards fail</li><li>Useful for routes that require a selected config or authenticated state</li></ul><h3 id="section-based-navigation" tabindex="-1">Section-Based Navigation <a class="header-anchor" href="#section-based-navigation" aria-label="Permalink to “Section-Based Navigation”">​</a></h3><p>Group routes by section for tab-style navigation:</p><ul><li>Extract section from route string (e.g., <code>&#39;config/add&#39;</code> → section: <code>&#39;config&#39;</code>)</li><li>Enable parent route navigation (e.g., <code>&#39;config/add&#39;</code> → parent: <code>&#39;config&#39;</code>)</li><li>Useful for breadcrumb-style navigation or tab highlighting</li></ul><h2 id="file-structure" tabindex="-1">File Structure <a class="header-anchor" href="#file-structure" aria-label="Permalink to “File Structure”">​</a></h2><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>src/cli/</span></span>
<span class="line"><span>├── index.tsx              # Entry point, meow setup</span></span>
<span class="line"><span>├── app.tsx                # Root App component</span></span>
<span class="line"><span>├── router.tsx             # Router context and hooks</span></span>
<span class="line"><span>├── screens.tsx            # Route → Component registry</span></span>
<span class="line"><span>├── keyboard.tsx           # Global keyboard handler</span></span>
<span class="line"><span>├── types.ts               # Type definitions</span></span>
<span class="line"><span>└── screens/</span></span>
<span class="line"><span>    ├── home.tsx</span></span>
<span class="line"><span>    ├── config/</span></span>
<span class="line"><span>    │   ├── list.tsx</span></span>
<span class="line"><span>    │   ├── add.tsx</span></span>
<span class="line"><span>    │   ├── edit.tsx</span></span>
<span class="line"><span>    │   └── rm.tsx</span></span>
<span class="line"><span>    └── ...</span></span></code></pre></div><h2 id="comparison-our-router-vs-pastel" tabindex="-1">Comparison: Our Router vs Pastel <a class="header-anchor" href="#comparison-our-router-vs-pastel" aria-label="Permalink to “Comparison: Our Router vs Pastel”">​</a></h2><table tabindex="0"><thead><tr><th>Feature</th><th>Pastel</th><th>Our Router</th></tr></thead><tbody><tr><td>Route Definition</td><td>File-based (magic)</td><td>Explicit registry</td></tr><tr><td>Type Safety</td><td>Zod schemas</td><td>TypeScript unions</td></tr><tr><td>CLI Parsing</td><td>Built-in</td><td>meow</td></tr><tr><td>Ink Version</td><td>v4 only</td><td>v6 compatible</td></tr><tr><td>Code Splitting</td><td>Automatic</td><td>Manual (React.lazy)</td></tr><tr><td>Build Step</td><td>Required</td><td>Optional</td></tr><tr><td>Learning Curve</td><td>Next.js familiar</td><td>React Router familiar</td></tr><tr><td>Bundle Size</td><td>Larger</td><td>Minimal</td></tr></tbody></table><h2 id="alternatives-considered" tabindex="-1">Alternatives Considered <a class="header-anchor" href="#alternatives-considered" aria-label="Permalink to “Alternatives Considered”">​</a></h2><p>Other approaches were evaluated but didn&#39;t fit our requirements:</p><ul><li><strong>React Router / Wouter</strong> - URL-based routing doesn&#39;t map well to CLI navigation</li><li><strong>XState</strong> - Better suited for multi-step workflows within a single screen, overkill for screen navigation</li><li><strong>Pastel</strong> - May eventually support Ink v6, but building our own gives full control without external dependency risk</li></ul><h2 id="considerations" tabindex="-1">Considerations <a class="header-anchor" href="#considerations" aria-label="Permalink to “Considerations”">​</a></h2><h3 id="complexity-factors" tabindex="-1">Complexity Factors <a class="header-anchor" href="#complexity-factors" aria-label="Permalink to “Complexity Factors”">​</a></h3><table tabindex="0"><thead><tr><th>Component</th><th>Notes</th></tr></thead><tbody><tr><td>Types</td><td>Union types, params interface</td></tr><tr><td>Router Context</td><td>State management, history stack</td></tr><tr><td>Screen Registry</td><td>Lazy loading optional</td></tr><tr><td>meow Setup</td><td>Subcommand parsing from input</td></tr><tr><td>Global Keyboard</td><td>Ink useInput integration</td></tr><tr><td>Headless Mode</td><td>Alternative execution path</td></tr></tbody></table><p>Most effort goes into:</p><ol><li>Writing individual screen components</li><li>Defining the route-to-input mapping logic</li><li>Implementing headless command handlers (if needed)</li></ol><h2 id="conclusion" tabindex="-1">Conclusion <a class="header-anchor" href="#conclusion" aria-label="Permalink to “Conclusion”">​</a></h2><p>Building a custom router for Ink v6 is a pragmatic choice that:</p><ul><li>Keeps dependencies minimal</li><li>Provides full type safety</li><li>Supports both TUI and headless modes</li><li>Requires no build-time magic</li><li>Is simple enough to understand and maintain</li></ul><p>The router infrastructure is lightweight, with most complexity in the screen components themselves.</p></div></div></main><footer class="VPDocFooter" data-v-d668f7cc data-v-1bcd8184><!--[--><!--]--><!----><nav class="prev-next" aria-labelledby="doc-footer-aria-label" data-v-1bcd8184><span class="visually-hidden" id="doc-footer-aria-label" data-v-1bcd8184>Pager</span><div class="pager" data-v-1bcd8184><!----></div><div class="pager" data-v-1bcd8184><a class="VPLink link pager-link next" href="/dev/" data-v-1bcd8184><!--[--><span class="desc" data-v-1bcd8184>Next page</span><span class="title" data-v-1bcd8184>Overview</span><!--]--></a></div></nav></footer><!--[--><!--]--></div></div></div><!--[--><!--]--></div></div><!----><!--[--><!--]--></div></div>
    <script>window.__VP_HASH_MAP__=JSON.parse("{\"dev_change.md\":\"C8I7x_tz\",\"dev_ci.md\":\"DAJ_2Xk0\",\"dev_cli-router-implementation.md\":\"CSMrh0qO\",\"dev_config-sharing.md\":\"DM5BZTSL\",\"dev_config.md\":\"Cat17gqA\",\"dev_datamodel.md\":\"BzRziNj_\",\"dev_explore.md\":\"BPgB0xZb\",\"dev_headless.md\":\"chgjWtOe\",\"dev_identity.md\":\"BNwjCqJx\",\"dev_index.md\":\"CkYGriO3\",\"dev_ink-cheatsheet.md\":\"CYU4p8rl\",\"dev_ink-testing-library-cheatsheet.md\":\"shhX6yhY\",\"dev_lock.md\":\"Bg3RmB_o\",\"dev_logger.md\":\"BJA92-JC\",\"dev_project-discovery.md\":\"BYX_svZ3\",\"dev_readme.md\":\"DxYqaP16\",\"dev_runner.md\":\"B-frcj_W\",\"dev_sdk.md\":\"bBD_6MAI\",\"dev_secrets.md\":\"BLkkdNVR\",\"dev_settings.md\":\"BN4MywzB\",\"dev_sql-terminal.md\":\"C8m0HNFT\",\"dev_state.md\":\"BQx_s9g4\",\"dev_teardown.md\":\"BrDTmdOg\",\"dev_template.md\":\"D3-jujw_\",\"dev_version.md\":\"Dere2YL8\",\"getting-started_building-your-sdk.md\":\"DpxpjmRq\",\"getting-started_concepts.md\":\"BNpOCbEt\",\"getting-started_first-build.md\":\"Ck0ilBkN\",\"getting-started_installation.md\":\"DzoYSzJ-\",\"guide_changes_forward-revert.md\":\"C51Y2MA7\",\"guide_changes_history.md\":\"Ce4hEdNZ\",\"guide_changes_overview.md\":\"8RWQcfR2\",\"guide_database_explore.md\":\"DkIToWLb\",\"guide_database_teardown.md\":\"DmkvYi07\",\"guide_database_terminal.md\":\"BWe9iIox\",\"guide_environments_configs.md\":\"D5beb1gT\",\"guide_environments_secrets.md\":\"1rOF0VPO\",\"guide_environments_stages.md\":\"CjbjP8QA\",\"guide_sql-files_execution.md\":\"DkKKUgaM\",\"guide_sql-files_organization.md\":\"D5W0DbFF\",\"guide_sql-files_templates.md\":\"B6WyZ2py\",\"headless.md\":\"CwGar4tr\",\"index.md\":\"pxiTM7pj\",\"reference_sdk.md\":\"DqAsiTzI\",\"tui.md\":\"srnoQpYU\"}");window.__VP_SITE_DATA__=JSON.parse("{\"lang\":\"en-US\",\"dir\":\"ltr\",\"title\":\"noorm\",\"description\":\"Database Schema & Change Manager\",\"base\":\"/\",\"head\":[],\"router\":{\"prefetchLinks\":true},\"appearance\":true,\"themeConfig\":{\"logo\":\"/image/logo.png\",\"siteTitle\":\"noorm\",\"nav\":[{\"text\":\"Home\",\"link\":\"/\"},{\"text\":\"Getting Started\",\"link\":\"/getting-started/installation\"},{\"text\":\"Guide\",\"link\":\"/guide/sql-files/organization\"},{\"text\":\"TUI\",\"link\":\"/tui\"},{\"text\":\"Headless\",\"link\":\"/headless\"},{\"text\":\"Dev Docs\",\"link\":\"/dev/\"}],\"sidebar\":{\"/dev/\":[{\"text\":\"Core Modules\",\"items\":[{\"text\":\"Overview\",\"link\":\"/dev/\"},{\"text\":\"Change Management\",\"link\":\"/dev/change\"},{\"text\":\"Configuration\",\"link\":\"/dev/config\"},{\"text\":\"Runner\",\"link\":\"/dev/runner\"},{\"text\":\"Settings\",\"link\":\"/dev/settings\"},{\"text\":\"State\",\"link\":\"/dev/state\"}]},{\"text\":\"Features\",\"items\":[{\"text\":\"Database Explorer\",\"link\":\"/dev/explore\"},{\"text\":\"SQL Terminal\",\"link\":\"/dev/sql-terminal\"},{\"text\":\"Templates\",\"link\":\"/dev/template\"},{\"text\":\"Secrets\",\"link\":\"/dev/secrets\"},{\"text\":\"Locking\",\"link\":\"/dev/lock\"},{\"text\":\"Teardown\",\"link\":\"/dev/teardown\"},{\"text\":\"Config Sharing\",\"link\":\"/dev/config-sharing\"}]},{\"text\":\"Integration\",\"items\":[{\"text\":\"SDK\",\"link\":\"/dev/sdk\"},{\"text\":\"Headless Mode\",\"link\":\"/dev/headless\"},{\"text\":\"CI/CD\",\"link\":\"/dev/ci\"},{\"text\":\"Identity\",\"link\":\"/dev/identity\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"Data Model\",\"link\":\"/dev/datamodel\"},{\"text\":\"Logger\",\"link\":\"/dev/logger\"},{\"text\":\"Versioning\",\"link\":\"/dev/version\"}]}],\"/\":[{\"text\":\"Getting Started\",\"items\":[{\"text\":\"Installation\",\"link\":\"/getting-started/installation\"},{\"text\":\"First Build\",\"link\":\"/getting-started/first-build\"},{\"text\":\"Building Your SDK\",\"link\":\"/getting-started/building-your-sdk\"},{\"text\":\"Concepts\",\"link\":\"/getting-started/concepts\"}]},{\"text\":\"Features\",\"items\":[{\"text\":\"Terminal UI\",\"link\":\"/tui\"},{\"text\":\"Headless Mode\",\"link\":\"/headless\"}]},{\"text\":\"SQL Files\",\"collapsed\":true,\"items\":[{\"text\":\"Organization\",\"link\":\"/guide/sql-files/organization\"},{\"text\":\"Templates\",\"link\":\"/guide/sql-files/templates\"},{\"text\":\"Execution\",\"link\":\"/guide/sql-files/execution\"}]},{\"text\":\"Environments\",\"collapsed\":true,\"items\":[{\"text\":\"Configs\",\"link\":\"/guide/environments/configs\"},{\"text\":\"Stages\",\"link\":\"/guide/environments/stages\"},{\"text\":\"Secrets\",\"link\":\"/guide/environments/secrets\"}]},{\"text\":\"Changes\",\"collapsed\":true,\"items\":[{\"text\":\"Overview\",\"link\":\"/guide/changes/overview\"},{\"text\":\"Forward & Revert\",\"link\":\"/guide/changes/forward-revert\"},{\"text\":\"History\",\"link\":\"/guide/changes/history\"}]},{\"text\":\"Database\",\"collapsed\":true,\"items\":[{\"text\":\"Explorer\",\"link\":\"/guide/database/explore\"},{\"text\":\"Teardown\",\"link\":\"/guide/database/teardown\"},{\"text\":\"Terminal\",\"link\":\"/guide/database/terminal\"}]},{\"text\":\"Reference\",\"items\":[{\"text\":\"SDK\",\"link\":\"/reference/sdk\"}]}]},\"socialLinks\":[{\"icon\":\"github\",\"link\":\"https://github.com/noormdev/noorm\"}],\"search\":{\"provider\":\"local\"},\"outline\":{\"level\":[2,3]}},\"locales\":{},\"scrollOffset\":134,\"cleanUrls\":false,\"additionalConfig\":{}}");</script>
    
  </body>
</html>