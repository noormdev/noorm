import{_ as i,c as e,o as a,a6 as t}from"./chunks/framework.YF6eQPX_.js";const o=JSON.parse('{"title":"Secrets","description":"","frontmatter":{},"headers":[],"relativePath":"guide/environments/secrets.md","filePath":"guide/environments/secrets.md"}'),n={name:"guide/environments/secrets.md"};function l(h,s,r,p,k,d){return a(),e("div",null,[...s[0]||(s[0]=[t(`<h1 id="secrets" tabindex="-1">Secrets <a class="header-anchor" href="#secrets" aria-label="Permalink to “Secrets”">​</a></h1><p>Sensitive values like database passwords and API keys have no place in config files. noorm provides encrypted secret storage that travels with your project, unlocks with your identity, and injects into templates at runtime.</p><h2 id="what-secrets-are" tabindex="-1">What Secrets Are <a class="header-anchor" href="#what-secrets-are" aria-label="Permalink to “What Secrets Are”">​</a></h2><p>Secrets are encrypted key-value pairs stored in your local state file (<code>.noorm/state/state.enc</code>). They never touch disk in plain text.</p><p>Common uses:</p><ul><li>Database passwords</li><li>API keys</li><li>Service credentials</li><li>Connection strings</li></ul><p>Secrets integrate directly with SQL templates, so you can reference them without exposing values in your source code.</p><h2 id="setting-a-secret" tabindex="-1">Setting a Secret <a class="header-anchor" href="#setting-a-secret" aria-label="Permalink to “Setting a Secret”">​</a></h2><p>Set secrets for the active config:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Interactive prompt (masks input)</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret:set</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Set a specific secret</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret:set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DB_PASSWORD</span></span></code></pre></div><p>The CLI masks password input and validates connection strings as URIs. Once set, secrets appear in your secret list:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">              # List secrets for active config</span></span></code></pre></div><p>The list shows which secrets are set, which are missing, and their types. Values stay hidden.</p><h2 id="config-scoped-vs-global-secrets" tabindex="-1">Config-Scoped vs Global Secrets <a class="header-anchor" href="#config-scoped-vs-global-secrets" aria-label="Permalink to “Config-Scoped vs Global Secrets”">​</a></h2><p>Secrets come in two scopes:</p><table tabindex="0"><thead><tr><th>Scope</th><th>Use Case</th><th>Example</th></tr></thead><tbody><tr><td>Config-scoped</td><td>Per-environment credentials</td><td>Database password for <code>prod</code></td></tr><tr><td>Global</td><td>Shared across all configs</td><td>Third-party API key</td></tr></tbody></table><p><strong>Config-scoped secrets</strong> belong to a single config. When you delete the config, its secrets go with it.</p><p><strong>Global secrets</strong> persist independently and are available everywhere.</p><p>In templates, access them differently:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Config-scoped secret</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> USER</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> readonly</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{%~ $.secrets.DB_PASSWORD %}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Global secret</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- Using API key: {%~ $.globalSecrets.SHARED_API_KEY %}</span></span></code></pre></div><p>See <a href="/guide/sql-files/templates.html">Templates</a> for full syntax reference.</p><h2 id="using-secrets-in-templates" tabindex="-1">Using Secrets in Templates <a class="header-anchor" href="#using-secrets-in-templates" aria-label="Permalink to “Using Secrets in Templates”">​</a></h2><p>Secrets inject into SQL templates via the <code>$</code> context object:</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- sql/users/create-readonly.sql.tmpl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> USER {%~ $.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">secrets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READONLY_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %}</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">WITH</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;{%~ $.secrets.READONLY_PASSWORD %}&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">GRANT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> SELECT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> ON</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> ALL TABLES </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TO</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {%~ $.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">secrets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">READONLY_USER</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %};</span></span></code></pre></div><p>If a template references a missing secret, it fails at runtime. Define your required secrets upfront to catch this early.</p><h2 id="secret-requirements-in-settings" tabindex="-1">Secret Requirements in Settings <a class="header-anchor" href="#secret-requirements-in-settings" aria-label="Permalink to “Secret Requirements in Settings”">​</a></h2><p>You can require secrets at two levels: <strong>universally</strong> (all configs) or <strong>per-stage</strong> (specific environments).</p><h3 id="universal-secrets" tabindex="-1">Universal Secrets <a class="header-anchor" href="#universal-secrets" aria-label="Permalink to “Universal Secrets”">​</a></h3><p>Define in the root <code>secrets</code> section of <code>settings.yml</code>:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .noorm/settings.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">secrets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">ENCRYPTION_KEY</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">password</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">App-wide encryption key</span></span></code></pre></div><p>Every config requires these secrets, regardless of stage.</p><h3 id="stage-secrets" tabindex="-1">Stage Secrets <a class="header-anchor" href="#stage-secrets" aria-label="Permalink to “Stage Secrets”">​</a></h3><p>Define within a stage to require secrets only for matching configs:</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .noorm/settings.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">stages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    prod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Production database</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        secrets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">password</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Main database password</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              required</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    staging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        secrets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">password</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DEBUG_KEY</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">string</span></span></code></pre></div><p>A config named <code>prod</code> requires its stage secrets plus universal secrets. A config named <code>dev</code> requires only universal secrets (plus any dev-stage secrets).</p><h3 id="secret-types" tabindex="-1">Secret Types <a class="header-anchor" href="#secret-types" aria-label="Permalink to “Secret Types”">​</a></h3><p>The <code>type</code> field controls input behavior:</p><table tabindex="0"><thead><tr><th>Type</th><th>Input Behavior</th></tr></thead><tbody><tr><td><code>string</code></td><td>Plain text</td></tr><tr><td><code>password</code></td><td>Masked, no echo</td></tr><tr><td><code>api_key</code></td><td>Masked, no echo</td></tr><tr><td><code>connection_string</code></td><td>Plain text, URI validation</td></tr></tbody></table><p>Types are hints for the CLI. All secrets are stored identically (encrypted strings).</p><h2 id="secrets-in-ci-cd" tabindex="-1">Secrets in CI/CD <a class="header-anchor" href="#secrets-in-ci-cd" aria-label="Permalink to “Secrets in CI/CD”">​</a></h2><p>For non-interactive environments, pass secret values as arguments:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Set secret in headless mode</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret:set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DB_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;mypassword&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># List secrets with JSON output</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --json</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># Delete without confirmation</span></span>
<span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -y</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret:rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MY_API_KEY</span></span></code></pre></div><p>Alternatively, pipe values from your CI environment:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">echo</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">$DB_PASSWORD</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> |</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret:set</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> DB_PASSWORD</span></span></code></pre></div><p>This keeps secrets out of command history while still automating setup.</p><h2 id="security-notes" tabindex="-1">Security Notes <a class="header-anchor" href="#security-notes" aria-label="Permalink to “Security Notes”">​</a></h2><p>noorm takes several measures to protect your secrets:</p><ol><li><strong>Encryption at rest</strong> - Secrets are stored in <code>.noorm/state/state.enc</code> using AES-256-GCM encryption</li><li><strong>Key derivation</strong> - The encryption key derives from your private identity key via HKDF</li><li><strong>Values never displayed</strong> - The CLI shows secret keys only, never values</li><li><strong>Masked input</strong> - Password-type secrets use non-echoing input</li><li><strong>No logging</strong> - Secret values are never emitted to observer events</li><li><strong>Automatic redaction</strong> - The logger masks secret fields if they appear in event data</li></ol><div class="warning custom-block"><p class="custom-block-title">Don&#39;t Commit state.enc</p><p>Add <code>.noorm/state/state.enc</code> to your <code>.gitignore</code>. The file is encrypted with machine-specific keys and won&#39;t work on other machines.</p></div><h2 id="deleting-secrets" tabindex="-1">Deleting Secrets <a class="header-anchor" href="#deleting-secrets" aria-label="Permalink to “Deleting Secrets”">​</a></h2><p>Remove optional secrets when no longer needed:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> secret:rm</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> MY_API_KEY</span></span></code></pre></div><p>Required secrets (defined in settings) cannot be deleted, only updated. The CLI tells you whether a secret is universal or stage-specific when you try to delete a required one.</p><h2 id="what-s-next" tabindex="-1">What&#39;s Next? <a class="header-anchor" href="#what-s-next" aria-label="Permalink to “What&#39;s Next?”">​</a></h2><ul><li><a href="/guide/environments/stages.html">Stages</a> - Environment templates with secret requirements</li><li><a href="/guide/sql-files/templates.html">Templates</a> - Using secrets in dynamic SQL</li><li><a href="/guide/environments/configs.html">Configs</a> - Config-scoped vs global secrets</li></ul>`,55)])])}const g=i(n,[["render",l]]);export{o as __pageData,g as default};
