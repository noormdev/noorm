import{_ as i,I as s,c as n,o as e,a6 as d,b as o,w as a,a as l,J as h,a7 as c}from"./chunks/framework.YF6eQPX_.js";const E=JSON.parse('{"title":"Data Model Reference","description":"","frontmatter":{},"headers":[],"relativePath":"dev/datamodel.md","filePath":"dev/datamodel.md"}'),p={name:"dev/datamodel.md"};function b(g,t,m,u,y,k){const r=s("Mermaid");return e(),n("div",null,[t[1]||(t[1]=d('<h1 id="data-model-reference" tabindex="-1">Data Model Reference <a class="header-anchor" href="#data-model-reference" aria-label="Permalink to “Data Model Reference”">​</a></h1><h2 id="overview" tabindex="-1">Overview <a class="header-anchor" href="#overview" aria-label="Permalink to “Overview”">​</a></h2><p>This document consolidates all data structures used across noorm. It serves as a single reference for types, database schemas, file formats, and their relationships.</p><p>noorm separates data into three tiers:</p><table tabindex="0"><thead><tr><th>Tier</th><th>Storage</th><th>Encryption</th><th>Versioned</th></tr></thead><tbody><tr><td><strong>State</strong></td><td><code>.noorm/state/state.enc</code></td><td>AES-256-GCM</td><td>Git-ignored</td></tr><tr><td><strong>Settings</strong></td><td><code>.noorm/settings.yml</code></td><td>None</td><td>Committed</td></tr><tr><td><strong>Database</strong></td><td>Target database</td><td>N/A</td><td>Tracked in-db</td></tr></tbody></table><p>State holds secrets and credentials. Settings holds team-shared rules. Database tables track execution history.</p><h2 id="entity-relationship-diagram" tabindex="-1">Entity Relationship Diagram <a class="header-anchor" href="#entity-relationship-diagram" aria-label="Permalink to “Entity Relationship Diagram”">​</a></h2>',7)),(e(),o(c,null,{default:a(()=>[h(r,{id:"mermaid-80",class:"mermaid",graph:"erDiagram%0A%20%20%20%20STATE%20%7C%7C--o%7C%20CRYPTO_IDENTITY%20%3A%20has%0A%20%20%20%20STATE%20%7C%7C--o%7B%20KNOWN_USER%20%3A%20contains%0A%20%20%20%20STATE%20%7C%7C--o%7B%20CONFIG%20%3A%20stores%0A%20%20%20%20STATE%20%7C%7C--o%7B%20SECRET%20%3A%20encrypts%0A%0A%20%20%20%20CONFIG%20%7C%7C--%7C%7C%20CONNECTION_CONFIG%20%3A%20contains%0A%20%20%20%20CONFIG%20%7C%7C--o%7B%20SECRET%20%3A%20scoped_to%0A%0A%20%20%20%20SETTINGS%20%7C%7C--o%7B%20STAGE%20%3A%20defines%0A%20%20%20%20SETTINGS%20%7C%7C--o%7B%20RULE%20%3A%20contains%0A%20%20%20%20SETTINGS%20%7C%7C--%7C%7C%20BUILD_CONFIG%20%3A%20has%0A%20%20%20%20STAGE%20%7C%7C--o%7B%20STAGE_SECRET%20%3A%20requires%0A%0A%20%20%20%20DB_CHANGESET%20%7C%7C--o%7B%20DB_EXECUTION%20%3A%20parent_of%0A%20%20%20%20DB_LOCK%20%7C%7C--%7C%7C%20CONFIG%20%3A%20scoped_to%0A%20%20%20%20DB_IDENTITIES%20%7C%7C--o%7B%20KNOWN_USER%20%3A%20syncs_to%0A%0A%20%20%20%20CHANGESET_DISK%20%7C%7C--o%7B%20CHANGESET_FILE%20%3A%20contains%0A%20%20%20%20CHANGESET_DISK%20%7D%7C--%7C%7C%20DB_CHANGESET%20%3A%20tracked_in%0A"})]),fallback:a(()=>[...t[0]||(t[0]=[l(" Loading... ",-1)])]),_:1})),t[2]||(t[2]=d(`<hr><h2 id="state-encrypted" tabindex="-1">State (Encrypted) <a class="header-anchor" href="#state-encrypted" aria-label="Permalink to “State (Encrypted)”">​</a></h2><h3 id="state-file" tabindex="-1">State File <a class="header-anchor" href="#state-file" aria-label="Permalink to “State File”">​</a></h3><p>The encrypted state file at <code>.noorm/state/state.enc</code> contains all sensitive configuration.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>version</td><td>string</td><td>noorm version for migrations</td></tr><tr><td>identity</td><td>CryptoIdentity?</td><td>User&#39;s cryptographic identity</td></tr><tr><td>knownUsers</td><td>Map</td><td>Known users discovered from databases</td></tr><tr><td>activeConfig</td><td>string?</td><td>Currently selected config name</td></tr><tr><td>configs</td><td>Map</td><td>Database configurations by name</td></tr><tr><td>secrets</td><td>Map</td><td>Config-scoped secrets (configName → key → value)</td></tr><tr><td>globalSecrets</td><td>Map</td><td>App-level secrets shared across configs</td></tr></tbody></table><h3 id="encrypted-payload" tabindex="-1">Encrypted Payload <a class="header-anchor" href="#encrypted-payload" aria-label="Permalink to “Encrypted Payload”">​</a></h3><p>On-disk format for the state file.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>algorithm</td><td>string</td><td>Always <code>aes-256-gcm</code></td></tr><tr><td>iv</td><td>string</td><td>Initialization vector (base64)</td></tr><tr><td>authTag</td><td>string</td><td>Authentication tag (base64)</td></tr><tr><td>ciphertext</td><td>string</td><td>Encrypted state JSON (base64)</td></tr></tbody></table><p>The encryption key derives from machine-specific identifiers or the user&#39;s cryptographic identity passphrase.</p><hr><h2 id="configuration" tabindex="-1">Configuration <a class="header-anchor" href="#configuration" aria-label="Permalink to “Configuration”">​</a></h2><h3 id="config" tabindex="-1">Config <a class="header-anchor" href="#config" aria-label="Permalink to “Config”">​</a></h3><p>A database connection profile stored in encrypted state.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Yes</td><td>Unique identifier (e.g., <code>dev</code>, <code>staging</code>, <code>prod</code>)</td></tr><tr><td>type</td><td>enum</td><td>Yes</td><td><code>local</code> or <code>remote</code></td></tr><tr><td>isTest</td><td>boolean</td><td>Yes</td><td>Marks database as disposable for testing</td></tr><tr><td>protected</td><td>boolean</td><td>Yes</td><td>Requires confirmation for dangerous operations</td></tr><tr><td>connection</td><td>ConnectionConfig</td><td>Yes</td><td>Database connection details</td></tr><tr><td>paths</td><td>PathConfig</td><td>Yes</td><td>File system paths for schema and changes</td></tr><tr><td>identity</td><td>string</td><td>No</td><td>Override identity for <code>executed_by</code> field</td></tr></tbody></table><h3 id="connectionconfig" tabindex="-1">ConnectionConfig <a class="header-anchor" href="#connectionconfig" aria-label="Permalink to “ConnectionConfig”">​</a></h3><p>Database connection parameters.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Required</th><th>Description</th></tr></thead><tbody><tr><td>dialect</td><td>enum</td><td>Yes</td><td><code>postgres</code>, <code>mysql</code>, <code>sqlite</code>, or <code>mssql</code></td></tr><tr><td>host</td><td>string</td><td>Network</td><td>Hostname (required for non-SQLite)</td></tr><tr><td>port</td><td>number</td><td>No</td><td>Port number (defaults by dialect)</td></tr><tr><td>database</td><td>string</td><td>Yes</td><td>Database name</td></tr><tr><td>filename</td><td>string</td><td>SQLite</td><td>File path for SQLite databases</td></tr><tr><td>user</td><td>string</td><td>No</td><td>Database username</td></tr><tr><td>password</td><td>string</td><td>No</td><td>Database password</td></tr><tr><td>ssl</td><td>boolean or object</td><td>No</td><td>SSL/TLS configuration</td></tr><tr><td>pool</td><td>object</td><td>No</td><td>Connection pool settings (<code>min</code>, <code>max</code>)</td></tr></tbody></table><p><strong>Default ports by dialect:</strong></p><table tabindex="0"><thead><tr><th>Dialect</th><th>Default Port</th></tr></thead><tbody><tr><td>postgres</td><td>5432</td></tr><tr><td>mysql</td><td>3306</td></tr><tr><td>mssql</td><td>1433</td></tr><tr><td>sqlite</td><td>N/A</td></tr></tbody></table><h3 id="pathconfig" tabindex="-1">PathConfig <a class="header-anchor" href="#pathconfig" aria-label="Permalink to “PathConfig”">​</a></h3><p>File system paths for schema and changes.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>schema</td><td>string</td><td>Path to schema directory</td></tr><tr><td>changes</td><td>string</td><td>Path to changes directory</td></tr></tbody></table><h3 id="configsummary" tabindex="-1">ConfigSummary <a class="header-anchor" href="#configsummary" aria-label="Permalink to “ConfigSummary”">​</a></h3><p>Lightweight config view for listings. Omits sensitive connection details.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Config identifier</td></tr><tr><td>type</td><td>enum</td><td><code>local</code> or <code>remote</code></td></tr><tr><td>isTest</td><td>boolean</td><td>Test database flag</td></tr><tr><td>protected</td><td>boolean</td><td>Protection enabled</td></tr><tr><td>isActive</td><td>boolean</td><td>Currently selected config</td></tr></tbody></table><h3 id="config-resolution-order" tabindex="-1">Config Resolution Order <a class="header-anchor" href="#config-resolution-order" aria-label="Permalink to “Config Resolution Order”">​</a></h3><p>Configs merge from five sources in priority order:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>CLI flags &gt; Environment &gt; Stored config &gt; Stage defaults &gt; Defaults</span></span></code></pre></div><p>Higher priority sources override lower ones, enabling flexible overrides for CI/CD.</p><hr><h2 id="settings" tabindex="-1">Settings <a class="header-anchor" href="#settings" aria-label="Permalink to “Settings”">​</a></h2><h3 id="settings-file" tabindex="-1">Settings File <a class="header-anchor" href="#settings-file" aria-label="Permalink to “Settings File”">​</a></h3><p>The <code>.noorm/settings.yml</code> file configures project-wide behavior. Unlike state, this file is not encrypted and should be version controlled.</p><div class="language-yaml"><button title="Copy Code" class="copy"></button><span class="lang">yaml</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;"># .noorm/settings.yml</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">build</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    include</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">tables/**/*.sql</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">views/**/*.sql</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;**/*.test.sql&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">paths</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    sql</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db/sql</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    changes</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">db/changes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">stages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    dev</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Development database</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        defaults</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            dialect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            isTest</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    prod</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        description</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">Production database</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        locked</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        defaults</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            dialect</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">postgres</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">            protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">        secrets</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">            - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">key</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">DB_PASSWORD</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              type</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">password</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">              required</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">rules</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    - </span><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">match</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">          protected</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">      exclude</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;**/*.seed.sql&#39;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">strict</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    stages</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">dev</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">staging</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        - </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">prod</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">logging</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">:</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    enabled</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">true</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    level</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">info</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    file</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">.noorm/state/noorm.log</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    maxSize</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">10mb</span></span>
<span class="line"><span style="--shiki-light:#22863A;--shiki-dark:#85E89D;">    maxFiles</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">5</span></span></code></pre></div><h3 id="buildconfig" tabindex="-1">BuildConfig <a class="header-anchor" href="#buildconfig" aria-label="Permalink to “BuildConfig”">​</a></h3><p>Controls which files are included in build operations.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>include</td><td>string[]</td><td>Glob patterns for included files (filter only)</td></tr><tr><td>exclude</td><td>string[]</td><td>Glob patterns for excluded files</td></tr></tbody></table><p>Include acts as a filter, not an ordering mechanism. Files are executed in alphanumeric order—use numeric prefixes on directories and files to control the sequence. If not specified, all <code>.sql</code> files in the schema directory are included.</p><h3 id="pathconfig-settings" tabindex="-1">PathConfig (Settings) <a class="header-anchor" href="#pathconfig-settings" aria-label="Permalink to “PathConfig (Settings)”">​</a></h3><p>Override default file locations.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>schema</td><td>string</td><td><code>schema</code></td><td>Path to schema files</td></tr><tr><td>changes</td><td>string</td><td><code>changes</code></td><td>Path to change directories</td></tr></tbody></table><h3 id="stage" tabindex="-1">Stage <a class="header-anchor" href="#stage" aria-label="Permalink to “Stage”">​</a></h3><p>A stage is a config template that provides defaults and enforces constraints.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>description</td><td>string?</td><td>Human-readable description</td></tr><tr><td>locked</td><td>boolean?</td><td>When true, linked configs cannot be deleted</td></tr><tr><td>defaults</td><td>StageDefaults?</td><td>Default values for new configs</td></tr><tr><td>secrets</td><td>StageSecret[]</td><td>Required secrets for completeness</td></tr></tbody></table><h3 id="stagedefaults" tabindex="-1">StageDefaults <a class="header-anchor" href="#stagedefaults" aria-label="Permalink to “StageDefaults”">​</a></h3><p>Initial values when creating a config from a stage.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>dialect</td><td>enum?</td><td>Default database dialect</td></tr><tr><td>host</td><td>string?</td><td>Default hostname</td></tr><tr><td>port</td><td>number?</td><td>Default port</td></tr><tr><td>database</td><td>string?</td><td>Default database name</td></tr><tr><td>user</td><td>string?</td><td>Default username</td></tr><tr><td>password</td><td>string?</td><td>Default password</td></tr><tr><td>ssl</td><td>boolean?</td><td>Default SSL setting</td></tr><tr><td>isTest</td><td>boolean?</td><td>Default test flag</td></tr><tr><td>protected</td><td>boolean?</td><td>Default protection (cannot be overridden if true)</td></tr></tbody></table><h3 id="stagesecret" tabindex="-1">StageSecret <a class="header-anchor" href="#stagesecret" aria-label="Permalink to “StageSecret”">​</a></h3><p>Defines a required secret for configs linked to a stage.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>key</td><td>string</td><td>Required</td><td>Secret identifier</td></tr><tr><td>type</td><td>enum</td><td><code>string</code></td><td><code>string</code>, <code>password</code>, <code>api_key</code>, or <code>connection_string</code></td></tr><tr><td>description</td><td>string?</td><td>—</td><td>Human-readable description</td></tr><tr><td>required</td><td>boolean</td><td><code>true</code></td><td>Whether the secret must be set for completeness</td></tr></tbody></table><h3 id="rule" tabindex="-1">Rule <a class="header-anchor" href="#rule" aria-label="Permalink to “Rule”">​</a></h3><p>Conditional file inclusion/exclusion based on config properties.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>match</td><td>RuleMatch</td><td>Conditions that trigger this rule</td></tr><tr><td>include</td><td>string[]?</td><td>Additional glob patterns to include</td></tr><tr><td>exclude</td><td>string[]?</td><td>Additional glob patterns to exclude</td></tr></tbody></table><h3 id="rulematch" tabindex="-1">RuleMatch <a class="header-anchor" href="#rulematch" aria-label="Permalink to “RuleMatch”">​</a></h3><p>Conditions for rule evaluation.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string?</td><td>Match config by name</td></tr><tr><td>protected</td><td>boolean?</td><td>Match by protection status</td></tr><tr><td>isTest</td><td>boolean?</td><td>Match by test flag</td></tr><tr><td>type</td><td>enum?</td><td>Match by <code>local</code> or <code>remote</code></td></tr></tbody></table><p>All specified conditions must match for the rule to apply.</p><h3 id="strictconfig" tabindex="-1">StrictConfig <a class="header-anchor" href="#strictconfig" aria-label="Permalink to “StrictConfig”">​</a></h3><p>Enforce stage usage.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>enabled</td><td>boolean?</td><td>Enable strict mode</td></tr><tr><td>stages</td><td>string[]?</td><td>Required stages (configs must link to one)</td></tr></tbody></table><h3 id="loggingconfig" tabindex="-1">LoggingConfig <a class="header-anchor" href="#loggingconfig" aria-label="Permalink to “LoggingConfig”">​</a></h3><p>File logging configuration.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>enabled</td><td>boolean</td><td><code>true</code></td><td>Enable file logging</td></tr><tr><td>level</td><td>enum</td><td><code>info</code></td><td><code>silent</code>, <code>error</code>, <code>warn</code>, <code>info</code>, or <code>verbose</code></td></tr><tr><td>file</td><td>string</td><td><code>.noorm/state/noorm.log</code></td><td>Log file path</td></tr><tr><td>maxSize</td><td>string</td><td><code>10mb</code></td><td>Maximum file size before rotation</td></tr><tr><td>maxFiles</td><td>number</td><td><code>5</code></td><td>Maximum rotated files to keep</td></tr></tbody></table><hr><h2 id="identity" tabindex="-1">Identity <a class="header-anchor" href="#identity" aria-label="Permalink to “Identity”">​</a></h2><h3 id="identity-audit" tabindex="-1">Identity (Audit) <a class="header-anchor" href="#identity-audit" aria-label="Permalink to “Identity (Audit)”">​</a></h3><p>Simple identity used for tracking who executed database operations.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Display name</td></tr><tr><td>email</td><td>string?</td><td>Email address</td></tr><tr><td>source</td><td>enum</td><td>How identity was resolved</td></tr></tbody></table><p><strong>Identity sources (in resolution order):</strong></p><table tabindex="0"><thead><tr><th>Priority</th><th>Source</th><th>Description</th></tr></thead><tbody><tr><td>1</td><td><code>config</code></td><td>Override specified in config (for bots/services)</td></tr><tr><td>2</td><td><code>state</code></td><td>From encrypted state file (crypto identity)</td></tr><tr><td>3</td><td><code>env</code></td><td><code>NOORM_IDENTITY</code> env var (CI pipelines)</td></tr><tr><td>4</td><td><code>git</code></td><td>From git user.name and user.email</td></tr><tr><td>5</td><td><code>system</code></td><td>From OS username</td></tr></tbody></table><p>The resolver tries each source until it finds a valid identity.</p><h3 id="cryptoidentity" tabindex="-1">CryptoIdentity <a class="header-anchor" href="#cryptoidentity" aria-label="Permalink to “CryptoIdentity”">​</a></h3><p>Full cryptographic identity for secure config sharing. Stored in encrypted state.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>identityHash</td><td>string</td><td>SHA-256 of canonical identity string</td></tr><tr><td>name</td><td>string</td><td>Display name</td></tr><tr><td>email</td><td>string</td><td>Email address</td></tr><tr><td>publicKey</td><td>string</td><td>X25519 public key (hex)</td></tr><tr><td>machine</td><td>string</td><td>Machine hostname</td></tr><tr><td>os</td><td>string</td><td>OS platform and version</td></tr><tr><td>createdAt</td><td>string</td><td>ISO 8601 timestamp</td></tr></tbody></table><p><strong>Identity hash calculation:</strong></p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>SHA256(email + &#39;\\0&#39; + name + &#39;\\0&#39; + machine + &#39;\\0&#39; + os)</span></span></code></pre></div><p>The same user on different machines has different identities with different keypairs.</p><h3 id="knownuser" tabindex="-1">KnownUser <a class="header-anchor" href="#knownuser" aria-label="Permalink to “KnownUser”">​</a></h3><p>Cached identity discovered from database sync. Enables secure config sharing with team members.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>identityHash</td><td>string</td><td>SHA-256 of canonical identity string</td></tr><tr><td>email</td><td>string</td><td>User email</td></tr><tr><td>name</td><td>string</td><td>Display name</td></tr><tr><td>publicKey</td><td>string</td><td>X25519 public key (hex)</td></tr><tr><td>machine</td><td>string</td><td>Machine hostname</td></tr><tr><td>os</td><td>string</td><td>OS platform and version</td></tr><tr><td>lastSeen</td><td>string</td><td>ISO 8601 timestamp of last activity</td></tr><tr><td>source</td><td>string</td><td>Config name where discovered</td></tr></tbody></table><h3 id="key-files" tabindex="-1">Key Files <a class="header-anchor" href="#key-files" aria-label="Permalink to “Key Files”">​</a></h3><p>Cryptographic keys are stored outside the project directory.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>~/.noorm/</span></span>
<span class="line"><span>├── identity.key        # X25519 private key (hex, mode 600)</span></span>
<span class="line"><span>└── identity.pub        # X25519 public key (hex, mode 644)</span></span></code></pre></div><p>The private key never leaves the user&#39;s machine. The public key is shared via database identity tables.</p><hr><h2 id="encrypted-sharing" tabindex="-1">Encrypted Sharing <a class="header-anchor" href="#encrypted-sharing" aria-label="Permalink to “Encrypted Sharing”">​</a></h2><h3 id="sharedconfigpayload" tabindex="-1">SharedConfigPayload <a class="header-anchor" href="#sharedconfigpayload" aria-label="Permalink to “SharedConfigPayload”">​</a></h3><p>Format for encrypted config export files (<code>*.noorm.enc</code>).</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>version</td><td>number</td><td>Payload format version</td></tr><tr><td>sender</td><td>string</td><td>Sender&#39;s email</td></tr><tr><td>recipient</td><td>string</td><td>Recipient&#39;s email</td></tr><tr><td>ephemeralPubKey</td><td>string</td><td>Ephemeral X25519 public key (hex)</td></tr><tr><td>iv</td><td>string</td><td>Initialization vector (hex)</td></tr><tr><td>authTag</td><td>string</td><td>Authentication tag (hex)</td></tr><tr><td>ciphertext</td><td>string</td><td>Encrypted config (hex)</td></tr></tbody></table><h3 id="exportedconfig" tabindex="-1">ExportedConfig <a class="header-anchor" href="#exportedconfig" aria-label="Permalink to “ExportedConfig”">​</a></h3><p>The decrypted contents of a shared config.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Config name</td></tr><tr><td>dialect</td><td>string</td><td>Database dialect</td></tr><tr><td>connection</td><td>object</td><td>Host, port, database, ssl, pool (no user/password)</td></tr><tr><td>paths</td><td>object</td><td>Schema and change directories</td></tr><tr><td>isTest</td><td>boolean</td><td>Test database flag</td></tr><tr><td>protected</td><td>boolean</td><td>Protection status</td></tr><tr><td>secrets</td><td>Map</td><td>Config-scoped secrets</td></tr></tbody></table><p><strong>Note:</strong> <code>user</code> and <code>password</code> are intentionally omitted. Recipients provide their own credentials on import.</p><hr><h2 id="database-tables" tabindex="-1">Database Tables <a class="header-anchor" href="#database-tables" aria-label="Permalink to “Database Tables”">​</a></h2><p>noorm creates five tracking tables in the target database. All table names are prefixed with <code>__noorm_</code> to avoid conflicts.</p><h3 id="noorm-version" tabindex="-1"><code>__noorm_version__</code> <a class="header-anchor" href="#noorm-version" aria-label="Permalink to “__noorm_version__”">​</a></h3><p>Tracks noorm CLI version for internal schema migrations.</p><table tabindex="0"><thead><tr><th>Column</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>serial</td><td>PK</td><td>Primary key</td></tr><tr><td>cli_version</td><td>varchar(50)</td><td>NOT NULL</td><td>noorm version (semver)</td></tr><tr><td>noorm_version</td><td>integer</td><td>NOT NULL</td><td>Tracking table schema version</td></tr><tr><td>state_version</td><td>integer</td><td>NOT NULL</td><td>State file format version</td></tr><tr><td>settings_version</td><td>integer</td><td>NOT NULL</td><td>Settings file format version</td></tr><tr><td>installed_at</td><td>timestamp</td><td>NOT NULL, DEFAULT NOW()</td><td>First installation</td></tr><tr><td>upgraded_at</td><td>timestamp</td><td>NOT NULL, DEFAULT NOW()</td><td>Last upgrade</td></tr></tbody></table><p>This table tracks noorm&#39;s internal schema, not the user&#39;s database schema.</p><h3 id="noorm-change" tabindex="-1"><code>__noorm_change__</code> <a class="header-anchor" href="#noorm-change" aria-label="Permalink to “__noorm_change__”">​</a></h3><p>Tracks all operation batches—changes, builds, and ad-hoc runs.</p><table tabindex="0"><thead><tr><th>Column</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>serial</td><td>PK</td><td>Primary key</td></tr><tr><td>name</td><td>varchar(255)</td><td>NOT NULL</td><td>Operation identifier</td></tr><tr><td>change_type</td><td>varchar(50)</td><td>NOT NULL</td><td><code>build</code>, <code>run</code>, or <code>change</code></td></tr><tr><td>direction</td><td>varchar(50)</td><td>NOT NULL</td><td><code>change</code> or <code>revert</code></td></tr><tr><td>checksum</td><td>varchar(64)</td><td>NOT NULL</td><td>SHA-256 of sorted file checksums</td></tr><tr><td>executed_at</td><td>timestamp</td><td>NOT NULL, DEFAULT NOW()</td><td>When executed</td></tr><tr><td>executed_by</td><td>varchar(255)</td><td>NOT NULL</td><td>Identity string</td></tr><tr><td>config_name</td><td>varchar(255)</td><td>NOT NULL</td><td>Which config was used</td></tr><tr><td>cli_version</td><td>varchar(50)</td><td>NOT NULL</td><td>noorm version</td></tr><tr><td>status</td><td>varchar(50)</td><td>NOT NULL</td><td><code>pending</code>, <code>success</code>, <code>failed</code>, <code>reverted</code></td></tr><tr><td>error_message</td><td>text</td><td>NOT NULL</td><td>Error details (empty = no error)</td></tr><tr><td>duration_ms</td><td>integer</td><td>NOT NULL</td><td>Execution time (0 = never ran)</td></tr></tbody></table><p><strong>Name formats by change type:</strong></p><table tabindex="0"><thead><tr><th>Change Type</th><th>Format</th><th>Example</th></tr></thead><tbody><tr><td>change</td><td>Folder name</td><td><code>2024-01-15_add-users</code></td></tr><tr><td>build</td><td><code>build:{timestamp}</code></td><td><code>build:2024-01-15T10:30:00</code></td></tr><tr><td>run</td><td><code>run:{timestamp}</code></td><td><code>run:2024-01-15T10:30:00</code></td></tr></tbody></table><h3 id="noorm-executions" tabindex="-1"><code>__noorm_executions__</code> <a class="header-anchor" href="#noorm-executions" aria-label="Permalink to “__noorm_executions__”">​</a></h3><p>Tracks individual file executions within an operation.</p><table tabindex="0"><thead><tr><th>Column</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>serial</td><td>PK</td><td>Primary key</td></tr><tr><td>change_id</td><td>integer</td><td>FK, NOT NULL</td><td>Parent operation</td></tr><tr><td>filepath</td><td>varchar(500)</td><td>NOT NULL</td><td>Executed file path</td></tr><tr><td>file_type</td><td>varchar(10)</td><td>NOT NULL</td><td><code>sql</code> or <code>txt</code></td></tr><tr><td>checksum</td><td>varchar(64)</td><td>NOT NULL</td><td>SHA-256 of file contents</td></tr><tr><td>cli_version</td><td>varchar(50)</td><td>NOT NULL</td><td>noorm version</td></tr><tr><td>status</td><td>varchar(50)</td><td>NOT NULL</td><td><code>pending</code>, <code>success</code>, <code>failed</code>, <code>skipped</code></td></tr><tr><td>error_message</td><td>text</td><td>NOT NULL</td><td>Error details (empty = no error)</td></tr><tr><td>skip_reason</td><td>varchar(100)</td><td>NOT NULL</td><td>Why skipped (empty = not skipped)</td></tr><tr><td>duration_ms</td><td>integer</td><td>NOT NULL</td><td>Execution time (0 = never ran)</td></tr></tbody></table><h3 id="noorm-lock" tabindex="-1"><code>__noorm_lock__</code> <a class="header-anchor" href="#noorm-lock" aria-label="Permalink to “__noorm_lock__”">​</a></h3><p>Prevents concurrent operations on the same database.</p><table tabindex="0"><thead><tr><th>Column</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>serial</td><td>PK</td><td>Primary key</td></tr><tr><td>config_name</td><td>varchar(255)</td><td>UNIQUE, NOT NULL</td><td>Lock scope</td></tr><tr><td>locked_by</td><td>varchar(255)</td><td>NOT NULL</td><td>Identity of holder</td></tr><tr><td>locked_at</td><td>timestamp</td><td>NOT NULL, DEFAULT NOW()</td><td>When acquired</td></tr><tr><td>expires_at</td><td>timestamp</td><td>NOT NULL</td><td>Auto-expiry time</td></tr><tr><td>reason</td><td>varchar(255)</td><td>NOT NULL</td><td>Lock reason (empty = none)</td></tr></tbody></table><p>Locks automatically expire to prevent deadlocks from crashed processes.</p><h3 id="noorm-identities" tabindex="-1"><code>__noorm_identities__</code> <a class="header-anchor" href="#noorm-identities" aria-label="Permalink to “__noorm_identities__”">​</a></h3><p>Stores user identities for team discovery.</p><table tabindex="0"><thead><tr><th>Column</th><th>Type</th><th>Constraints</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>serial</td><td>PK</td><td>Primary key</td></tr><tr><td>identity_hash</td><td>varchar(64)</td><td>UNIQUE, NOT NULL</td><td>SHA-256 of identity</td></tr><tr><td>email</td><td>varchar(255)</td><td>NOT NULL</td><td>User email</td></tr><tr><td>name</td><td>varchar(255)</td><td>NOT NULL</td><td>Display name</td></tr><tr><td>machine</td><td>varchar(255)</td><td>NOT NULL</td><td>Machine hostname</td></tr><tr><td>os</td><td>varchar(255)</td><td>NOT NULL</td><td>OS platform and version</td></tr><tr><td>public_key</td><td>text</td><td>NOT NULL</td><td>X25519 public key (hex)</td></tr><tr><td>registered_at</td><td>timestamp</td><td>NOT NULL, DEFAULT NOW()</td><td>First registration</td></tr><tr><td>last_seen_at</td><td>timestamp</td><td>NOT NULL, DEFAULT NOW()</td><td>Last activity</td></tr></tbody></table><p>Auto-populated on first database connection when cryptographic identity is configured.</p><hr><h2 id="file-system-structures" tabindex="-1">File System Structures <a class="header-anchor" href="#file-system-structures" aria-label="Permalink to “File System Structures”">​</a></h2><h3 id="change-directory" tabindex="-1">Change Directory <a class="header-anchor" href="#change-directory" aria-label="Permalink to “Change Directory”">​</a></h3><p>Changes live on disk as directories with a specific structure.</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>changes/</span></span>
<span class="line"><span>└── 2024-01-15_add-email-verification/</span></span>
<span class="line"><span>    ├── change/</span></span>
<span class="line"><span>    │   ├── 001_add-column.sql</span></span>
<span class="line"><span>    │   ├── 002_update-data.sql</span></span>
<span class="line"><span>    │   └── 003_files.txt</span></span>
<span class="line"><span>    ├── revert/</span></span>
<span class="line"><span>    │   ├── 001_drop-column.sql</span></span>
<span class="line"><span>    │   └── 002_restore-data.sql</span></span>
<span class="line"><span>    └── changelog.md</span></span></code></pre></div><h3 id="change-parsed" tabindex="-1">Change (Parsed) <a class="header-anchor" href="#change-parsed" aria-label="Permalink to “Change (Parsed)”">​</a></h3><p>When read from disk, changes are parsed into:</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Folder name (e.g., <code>2024-01-15_add-email-verification</code>)</td></tr><tr><td>path</td><td>string</td><td>Absolute path to directory</td></tr><tr><td>date</td><td>Date?</td><td>Parsed from name prefix (YYYY-MM-DD)</td></tr><tr><td>description</td><td>string</td><td>Human-readable, derived from name</td></tr><tr><td>changeFiles</td><td>ChangeFile[]</td><td>Files in <code>change/</code> subdirectory</td></tr><tr><td>revertFiles</td><td>ChangeFile[]</td><td>Files in <code>revert/</code> subdirectory</td></tr><tr><td>hasChangelog</td><td>boolean</td><td>Whether <code>changelog.md</code> exists</td></tr></tbody></table><h3 id="changefile" tabindex="-1">ChangeFile <a class="header-anchor" href="#changefile" aria-label="Permalink to “ChangeFile”">​</a></h3><p>Individual file within a change.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>filename</td><td>string</td><td>File name (e.g., <code>001_alter-users.sql</code>)</td></tr><tr><td>path</td><td>string</td><td>Absolute path</td></tr><tr><td>type</td><td>enum</td><td><code>sql</code> or <code>txt</code></td></tr><tr><td>resolvedPaths</td><td>string[]?</td><td>For <code>.txt</code> files, paths to referenced files</td></tr><tr><td>status</td><td>enum?</td><td>Runtime status after execution</td></tr><tr><td>skipReason</td><td>string?</td><td>Why file was skipped</td></tr></tbody></table><p><strong>File types:</strong></p><table tabindex="0"><thead><tr><th>Type</th><th>Extension</th><th>Purpose</th></tr></thead><tbody><tr><td>sql</td><td><code>.sql</code>, <code>.sql.tmpl</code></td><td>Direct SQL execution (with optional templating)</td></tr><tr><td>txt</td><td><code>.txt</code></td><td>Manifest file listing paths to execute</td></tr></tbody></table><h3 id="change-naming" tabindex="-1">Change Naming <a class="header-anchor" href="#change-naming" aria-label="Permalink to “Change Naming”">​</a></h3><p>Change folder names follow a convention:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>{date}_{description}</span></span></code></pre></div><table tabindex="0"><thead><tr><th>Component</th><th>Format</th><th>Example</th></tr></thead><tbody><tr><td>date</td><td><code>YYYY-MM-DD</code></td><td><code>2024-01-15</code></td></tr><tr><td>description</td><td>kebab-case</td><td><code>add-email-verification</code></td></tr></tbody></table><p>The date prefix ensures chronological ordering. The description provides context.</p><hr><h2 id="runtime-types" tabindex="-1">Runtime Types <a class="header-anchor" href="#runtime-types" aria-label="Permalink to “Runtime Types”">​</a></h2><h3 id="operation-status" tabindex="-1">Operation Status <a class="header-anchor" href="#operation-status" aria-label="Permalink to “Operation Status”">​</a></h3><p>Used in <code>__noorm_change__</code> and change results.</p><table tabindex="0"><thead><tr><th>Status</th><th>Meaning</th></tr></thead><tbody><tr><td>pending</td><td>Not yet executed</td></tr><tr><td>success</td><td>Completed successfully</td></tr><tr><td>failed</td><td>Execution failed</td></tr><tr><td>reverted</td><td>Was applied, then rolled back</td></tr></tbody></table><h3 id="execution-status" tabindex="-1">Execution Status <a class="header-anchor" href="#execution-status" aria-label="Permalink to “Execution Status”">​</a></h3><p>Used in <code>__noorm_executions__</code> and file results.</p><table tabindex="0"><thead><tr><th>Status</th><th>Meaning</th></tr></thead><tbody><tr><td>pending</td><td>Not yet executed</td></tr><tr><td>success</td><td>Completed successfully</td></tr><tr><td>failed</td><td>Execution failed</td></tr><tr><td>skipped</td><td>Skipped (see skip reason)</td></tr></tbody></table><h3 id="skip-reasons" tabindex="-1">Skip Reasons <a class="header-anchor" href="#skip-reasons" aria-label="Permalink to “Skip Reasons”">​</a></h3><table tabindex="0"><thead><tr><th>Reason</th><th>Meaning</th></tr></thead><tbody><tr><td>unchanged</td><td>File checksum matches previous run</td></tr><tr><td>already-run</td><td>File was already executed successfully</td></tr><tr><td>change failed</td><td>Parent change failed</td></tr></tbody></table><h3 id="lock" tabindex="-1">Lock <a class="header-anchor" href="#lock" aria-label="Permalink to “Lock”">​</a></h3><p>Active lock state returned by lock operations.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>lockedBy</td><td>string</td><td>Identity of holder</td></tr><tr><td>lockedAt</td><td>Date</td><td>When acquired</td></tr><tr><td>expiresAt</td><td>Date</td><td>Auto-expiry time</td></tr><tr><td>reason</td><td>string?</td><td>Why lock was acquired</td></tr></tbody></table><h3 id="lock-options" tabindex="-1">Lock Options <a class="header-anchor" href="#lock-options" aria-label="Permalink to “Lock Options”">​</a></h3><p>Options for lock acquisition.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>timeout</td><td>number</td><td>300,000 (5 min)</td><td>Lock duration in ms</td></tr><tr><td>wait</td><td>boolean</td><td>false</td><td>Block until available</td></tr><tr><td>waitTimeout</td><td>number</td><td>30,000 (30 sec)</td><td>Maximum wait time in ms</td></tr><tr><td>pollInterval</td><td>number</td><td>1,000 (1 sec)</td><td>Check interval in ms</td></tr><tr><td>reason</td><td>string?</td><td>—</td><td>Lock reason</td></tr></tbody></table><h3 id="run-options" tabindex="-1">Run Options <a class="header-anchor" href="#run-options" aria-label="Permalink to “Run Options”">​</a></h3><p>Options for file execution.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Default</th><th>Description</th></tr></thead><tbody><tr><td>force</td><td>boolean</td><td>false</td><td>Re-run even if unchanged</td></tr><tr><td>concurrency</td><td>number</td><td>1</td><td>Parallel file execution</td></tr><tr><td>abortOnError</td><td>boolean</td><td>true</td><td>Stop on first failure</td></tr><tr><td>dryRun</td><td>boolean</td><td>false</td><td>Render to temp without executing</td></tr><tr><td>preview</td><td>boolean</td><td>false</td><td>Output SQL without executing</td></tr><tr><td>output</td><td>string?</td><td>—</td><td>Write rendered SQL to file</td></tr></tbody></table><p><strong>Note:</strong> Concurrency defaults to 1 (sequential) because DDL operations often cannot run in parallel.</p><hr><h2 id="template-context" tabindex="-1">Template Context <a class="header-anchor" href="#template-context" aria-label="Permalink to “Template Context”">​</a></h2><h3 id="template-context-object" tabindex="-1">Template Context Object (<code>$</code>) <a class="header-anchor" href="#template-context-object" aria-label="Permalink to “Template Context Object ($)”">​</a></h3><p>Available in <code>.sql.tmpl</code> templates via Eta.</p><table tabindex="0"><thead><tr><th>Property</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td><code>$.&lt;filename&gt;</code></td><td>any</td><td>Auto-loaded data from co-located files</td></tr><tr><td><code>$.config</code></td><td>object</td><td>Active config values</td></tr><tr><td><code>$.secrets</code></td><td>Map</td><td>Config-scoped secrets</td></tr><tr><td><code>$.globalSecrets</code></td><td>Map</td><td>App-level secrets</td></tr><tr><td><code>$.env</code></td><td>Map</td><td>Environment variables</td></tr></tbody></table><h3 id="built-in-helpers" tabindex="-1">Built-in Helpers <a class="header-anchor" href="#built-in-helpers" aria-label="Permalink to “Built-in Helpers”">​</a></h3><table tabindex="0"><thead><tr><th>Helper</th><th>Signature</th><th>Description</th></tr></thead><tbody><tr><td><code>$.include(path)</code></td><td>string → Promise&lt;string&gt;</td><td>Include another SQL file</td></tr><tr><td><code>$.escape(value)</code></td><td>string → string</td><td>SQL-escape a string</td></tr><tr><td><code>$.quote(value)</code></td><td>any → string</td><td>Escape and quote a value</td></tr><tr><td><code>$.json(value)</code></td><td>any → string</td><td>JSON stringify</td></tr><tr><td><code>$.now()</code></td><td>() → string</td><td>Current ISO timestamp</td></tr><tr><td><code>$.uuid()</code></td><td>() → string</td><td>Generate UUID v4</td></tr></tbody></table><h3 id="data-file-auto-loading" tabindex="-1">Data File Auto-Loading <a class="header-anchor" href="#data-file-auto-loading" aria-label="Permalink to “Data File Auto-Loading”">​</a></h3><p>Files co-located with templates are automatically loaded.</p><table tabindex="0"><thead><tr><th>Extension</th><th>Loader</th><th>Result</th></tr></thead><tbody><tr><td>.json, .json5</td><td>JSON parser</td><td>Object</td></tr><tr><td>.yaml, .yml</td><td>YAML parser</td><td>Object</td></tr><tr><td>.csv</td><td>CSV parser</td><td>Array of objects</td></tr><tr><td>.js, .mjs, .ts</td><td>Dynamic import</td><td>Default export</td></tr><tr><td>.sql</td><td>File read</td><td>String</td></tr></tbody></table><p>Data files are available on <code>$</code> by filename without extension:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>sql/</span></span>
<span class="line"><span>├── users.sql.tmpl      # Template</span></span>
<span class="line"><span>├── users.json          # Available as $.users</span></span>
<span class="line"><span>└── seed-data.csv       # Available as $.seedData</span></span></code></pre></div><hr><h2 id="version-management" tabindex="-1">Version Management <a class="header-anchor" href="#version-management" aria-label="Permalink to “Version Management”">​</a></h2><h3 id="version-layers" tabindex="-1">Version Layers <a class="header-anchor" href="#version-layers" aria-label="Permalink to “Version Layers”">​</a></h3><p>noorm tracks versions across three layers:</p><table tabindex="0"><thead><tr><th>Layer</th><th>Storage</th><th>Purpose</th></tr></thead><tbody><tr><td>schema</td><td>Database table</td><td>Tracking table structure</td></tr><tr><td>state</td><td>State file</td><td>Encrypted state format</td></tr><tr><td>settings</td><td>Settings file</td><td>Settings YAML format</td></tr></tbody></table><p>Each layer has independent migrations that run automatically when version mismatches are detected.</p><h3 id="current-versions" tabindex="-1">Current Versions <a class="header-anchor" href="#current-versions" aria-label="Permalink to “Current Versions”">​</a></h3><table tabindex="0"><thead><tr><th>Layer</th><th>Current Version</th></tr></thead><tbody><tr><td>schema</td><td>1</td></tr><tr><td>state</td><td>1</td></tr><tr><td>settings</td><td>1</td></tr></tbody></table><hr><h2 id="lifecycle-states" tabindex="-1">Lifecycle States <a class="header-anchor" href="#lifecycle-states" aria-label="Permalink to “Lifecycle States”">​</a></h2><h3 id="application-states" tabindex="-1">Application States <a class="header-anchor" href="#application-states" aria-label="Permalink to “Application States”">​</a></h3><table tabindex="0"><thead><tr><th>State</th><th>Meaning</th></tr></thead><tbody><tr><td>idle</td><td>Not started</td></tr><tr><td>starting</td><td>Initialization in progress</td></tr><tr><td>running</td><td>Normal operation</td></tr><tr><td>shutting_down</td><td>Graceful shutdown in progress</td></tr><tr><td>stopped</td><td>Clean shutdown complete</td></tr><tr><td>failed</td><td>Error during startup or shutdown</td></tr></tbody></table><h3 id="shutdown-phases" tabindex="-1">Shutdown Phases <a class="header-anchor" href="#shutdown-phases" aria-label="Permalink to “Shutdown Phases”">​</a></h3><p>Shutdown proceeds through ordered phases:</p><table tabindex="0"><thead><tr><th>Phase</th><th>Order</th><th>Purpose</th></tr></thead><tbody><tr><td>stopping</td><td>1</td><td>Stop accepting new operations</td></tr><tr><td>completing</td><td>2</td><td>Wait for in-flight operations</td></tr><tr><td>releasing</td><td>3</td><td>Release database locks</td></tr><tr><td>flushing</td><td>4</td><td>Flush logger buffers</td></tr><tr><td>exiting</td><td>5</td><td>Final cleanup</td></tr></tbody></table><h3 id="default-timeouts" tabindex="-1">Default Timeouts <a class="header-anchor" href="#default-timeouts" aria-label="Permalink to “Default Timeouts”">​</a></h3><table tabindex="0"><thead><tr><th>Phase</th><th>Default</th></tr></thead><tbody><tr><td>Operations</td><td>30 seconds</td></tr><tr><td>Locks</td><td>5 seconds</td></tr><tr><td>Connections</td><td>10 seconds</td></tr><tr><td>Logger</td><td>10 seconds</td></tr></tbody></table><hr><h2 id="database-exploration" tabindex="-1">Database Exploration <a class="header-anchor" href="#database-exploration" aria-label="Permalink to “Database Exploration”">​</a></h2><p>The explore module provides schema introspection across dialects.</p><h3 id="explorecategory" tabindex="-1">ExploreCategory <a class="header-anchor" href="#explorecategory" aria-label="Permalink to “ExploreCategory”">​</a></h3><p>Object types that can be explored:</p><table tabindex="0"><thead><tr><th>Category</th><th>Description</th></tr></thead><tbody><tr><td><code>tables</code></td><td>Database tables</td></tr><tr><td><code>views</code></td><td>Views and materialized views</td></tr><tr><td><code>procedures</code></td><td>Stored procedures</td></tr><tr><td><code>functions</code></td><td>User-defined functions</td></tr><tr><td><code>types</code></td><td>Custom types, enums, domains</td></tr><tr><td><code>indexes</code></td><td>Table indexes</td></tr><tr><td><code>foreignKeys</code></td><td>Foreign key constraints</td></tr><tr><td><code>triggers</code></td><td>Table triggers</td></tr><tr><td><code>locks</code></td><td>Active database locks</td></tr><tr><td><code>connections</code></td><td>Active sessions</td></tr></tbody></table><h3 id="exploreoverview" tabindex="-1">ExploreOverview <a class="header-anchor" href="#exploreoverview" aria-label="Permalink to “ExploreOverview”">​</a></h3><p>Count of objects in each category, returned by <code>getOverview()</code>.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>tables</td><td>number</td><td>Table count</td></tr><tr><td>views</td><td>number</td><td>View count</td></tr><tr><td>procedures</td><td>number</td><td>Stored procedure count</td></tr><tr><td>functions</td><td>number</td><td>Function count</td></tr><tr><td>types</td><td>number</td><td>Custom type count</td></tr><tr><td>indexes</td><td>number</td><td>Index count</td></tr><tr><td>foreignKeys</td><td>number</td><td>Foreign key count</td></tr><tr><td>triggers</td><td>number</td><td>Trigger count</td></tr><tr><td>locks</td><td>number</td><td>Active lock count</td></tr><tr><td>connections</td><td>number</td><td>Active connection count</td></tr></tbody></table><h3 id="summary-types" tabindex="-1">Summary Types <a class="header-anchor" href="#summary-types" aria-label="Permalink to “Summary Types”">​</a></h3><p>Brief metadata for list views.</p><p><strong>TableSummary:</strong></p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Table name</td></tr><tr><td>schema</td><td>string?</td><td>Schema/database name</td></tr><tr><td>columnCount</td><td>number</td><td>Number of columns</td></tr><tr><td>rowCountEstimate</td><td>number?</td><td>Estimated row count</td></tr></tbody></table><p><strong>ViewSummary:</strong></p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>View name</td></tr><tr><td>schema</td><td>string?</td><td>Schema/database name</td></tr><tr><td>columnCount</td><td>number</td><td>Number of columns</td></tr><tr><td>isUpdatable</td><td>boolean</td><td>Whether view is updatable</td></tr></tbody></table><p><strong>IndexSummary:</strong></p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Index name</td></tr><tr><td>tableName</td><td>string</td><td>Parent table</td></tr><tr><td>columns</td><td>string[]</td><td>Indexed columns</td></tr><tr><td>isUnique</td><td>boolean</td><td>Unique constraint</td></tr><tr><td>isPrimary</td><td>boolean</td><td>Primary key index</td></tr></tbody></table><p><strong>ForeignKeySummary:</strong></p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Constraint name</td></tr><tr><td>tableName</td><td>string</td><td>Source table</td></tr><tr><td>columns</td><td>string[]</td><td>Source columns</td></tr><tr><td>referencedTable</td><td>string</td><td>Target table</td></tr><tr><td>referencedColumns</td><td>string[]</td><td>Target columns</td></tr><tr><td>onDelete</td><td>string?</td><td>Delete action</td></tr><tr><td>onUpdate</td><td>string?</td><td>Update action</td></tr></tbody></table><h3 id="detail-types" tabindex="-1">Detail Types <a class="header-anchor" href="#detail-types" aria-label="Permalink to “Detail Types”">​</a></h3><p>Full metadata for detail views.</p><p><strong>ColumnDetail:</strong></p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Column name</td></tr><tr><td>dataType</td><td>string</td><td>SQL data type</td></tr><tr><td>isNullable</td><td>boolean</td><td>Allows NULL</td></tr><tr><td>defaultValue</td><td>string?</td><td>Default expression</td></tr><tr><td>isPrimaryKey</td><td>boolean</td><td>Part of primary key</td></tr><tr><td>ordinalPosition</td><td>number</td><td>Column order</td></tr></tbody></table><p><strong>TableDetail:</strong></p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>name</td><td>string</td><td>Table name</td></tr><tr><td>schema</td><td>string?</td><td>Schema name</td></tr><tr><td>columns</td><td>ColumnDetail[]</td><td>All columns</td></tr><tr><td>indexes</td><td>IndexSummary[]</td><td>Associated indexes</td></tr><tr><td>foreignKeys</td><td>ForeignKeySummary[]</td><td>Outgoing foreign keys</td></tr><tr><td>rowCountEstimate</td><td>number?</td><td>Estimated rows</td></tr></tbody></table><hr><h2 id="sql-terminal" tabindex="-1">SQL Terminal <a class="header-anchor" href="#sql-terminal" aria-label="Permalink to “SQL Terminal”">​</a></h2><p>The sql-terminal module provides ad-hoc SQL execution with history tracking.</p><h3 id="sqlhistoryentry" tabindex="-1">SqlHistoryEntry <a class="header-anchor" href="#sqlhistoryentry" aria-label="Permalink to “SqlHistoryEntry”">​</a></h3><p>A single query execution record.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>id</td><td>string</td><td>UUID v4 identifier</td></tr><tr><td>query</td><td>string</td><td>SQL query executed</td></tr><tr><td>executedAt</td><td>Date</td><td>Execution timestamp</td></tr><tr><td>durationMs</td><td>number</td><td>Execution duration in ms</td></tr><tr><td>success</td><td>boolean</td><td>Whether execution succeeded</td></tr><tr><td>errorMessage</td><td>string?</td><td>Error details if failed</td></tr><tr><td>rowCount</td><td>number?</td><td>Rows returned or affected</td></tr><tr><td>resultsFile</td><td>string?</td><td>Path to gzipped results</td></tr></tbody></table><h3 id="sqlexecutionresult" tabindex="-1">SqlExecutionResult <a class="header-anchor" href="#sqlexecutionresult" aria-label="Permalink to “SqlExecutionResult”">​</a></h3><p>Full result from query execution.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>success</td><td>boolean</td><td>Execution status</td></tr><tr><td>errorMessage</td><td>string?</td><td>Error if failed</td></tr><tr><td>columns</td><td>string[]?</td><td>Column names from result set</td></tr><tr><td>rows</td><td>object[]?</td><td>Row data as key-value objects</td></tr><tr><td>rowsAffected</td><td>number?</td><td>Rows affected (INSERT/UPDATE/DELETE)</td></tr><tr><td>durationMs</td><td>number</td><td>Execution time in ms</td></tr></tbody></table><h3 id="sqlhistoryfile" tabindex="-1">SqlHistoryFile <a class="header-anchor" href="#sqlhistoryfile" aria-label="Permalink to “SqlHistoryFile”">​</a></h3><p>Persistent history stored at <code>.noorm/state/history/{configName}.json</code>.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>version</td><td>string</td><td>Schema version</td></tr><tr><td>entries</td><td>SqlHistoryEntry[]</td><td>History entries (newest first)</td></tr></tbody></table><h3 id="clearresult" tabindex="-1">ClearResult <a class="header-anchor" href="#clearresult" aria-label="Permalink to “ClearResult”">​</a></h3><p>Result of clearing history.</p><table tabindex="0"><thead><tr><th>Field</th><th>Type</th><th>Description</th></tr></thead><tbody><tr><td>entriesRemoved</td><td>number</td><td>History entries deleted</td></tr><tr><td>filesRemoved</td><td>number</td><td>Result files deleted</td></tr></tbody></table><hr><h2 id="summary" tabindex="-1">Summary <a class="header-anchor" href="#summary" aria-label="Permalink to “Summary”">​</a></h2><p>noorm&#39;s data model spans three tiers with clear separation of concerns:</p><ol><li><strong>Encrypted State</strong> - Secrets, credentials, configs (<code>.noorm/state/state.enc</code>)</li><li><strong>Settings</strong> - Team rules, stages, build config (<code>.noorm/settings.yml</code>)</li><li><strong>Database Tables</strong> - Execution history, locks, identities (<code>__noorm_*</code>)</li></ol><p>The change file system provides versioned changes, while runtime types enable flexible execution modes (dry run, preview, force).</p><p>All types follow consistent patterns:</p><ul><li>Clear status enums for operation tracking</li><li>Duration timing on all executions</li><li>Error messages alongside status</li><li>Checksum-based change detection</li></ul>`,230))])}const x=i(p,[["render",b]]);export{E as __pageData,x as default};
