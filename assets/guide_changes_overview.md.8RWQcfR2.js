import{_ as i,c as e,o as a,a6 as n}from"./chunks/framework.YF6eQPX_.js";const c=JSON.parse('{"title":"Changes","description":"","frontmatter":{},"headers":[],"relativePath":"guide/changes/overview.md","filePath":"guide/changes/overview.md"}'),t={name:"guide/changes/overview.md"};function h(l,s,r,p,d,o){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="changes" tabindex="-1">Changes <a class="header-anchor" href="#changes" aria-label="Permalink to “Changes”">​</a></h1><p>Changes are versioned operations that evolve an existing database to match your ideal schema. When you need to add a column, transform data, or run SQL that should execute exactly once with rollback support, changes are the answer.</p><h2 id="why-changes-not-migrations" tabindex="-1">Why &quot;Changes&quot;, Not &quot;Migrations&quot; <a class="header-anchor" href="#why-changes-not-migrations" aria-label="Permalink to “Why &quot;Changes&quot;, Not &quot;Migrations&quot;”">​</a></h2><p>Most tools call these migrations. We don&#39;t, and here&#39;s why.</p><p><strong>Your SQL files are the source of truth.</strong> They define what your schema <em>is</em>—the ideal, current state. You handcraft them, review them, keep them up to date. When you need a fresh database, you run your SQL files. No archaeology through years of migration history.</p><p><strong>Changes describe what you <em>do</em>, not what you <em>move</em>.</strong> To migrate implies moving something from one place to another. Data migrations traditionally mean moving data between servers, warehouses, or systems. But when you add a column to an existing table, you&#39;re not migrating anything—you&#39;re changing the schema.</p><p>Some argue that you <em>are</em> moving data—adding a column means moving data into it, splitting <code>full_name</code> into <code>first_name</code> and <code>last_name</code> is moving data between columns, or you&#39;re &quot;moving the schema from one version to the next.&quot; This is mental gymnastics. It&#39;s stretching a word to fit a process it was never meant to describe.</p><p>The term &quot;migration&quot; originated in enterprise contexts where it actually made sense—incrementally moving schemas and data from Oracle to SQL Server, or consolidating legacy systems into a new platform. Rails borrowed this terminology in 2005 and popularized it for web applications. Everyone followed suit without questioning whether the word fit. We&#39;re not moving databases between systems. We&#39;re changing them in place. The language matters.</p><p><strong>Kysely already has migrations.</strong> If you want a traditional migration system, Kysely has one built in. But it lacks what noorm provides:</p><ul><li><strong>Identity tracking</strong> - Who ran what, and when?</li><li><strong>Flexible workflows</strong> - Build from scratch <em>or</em> apply changes, your choice</li><li><strong>Templates and secrets</strong> - Dynamic SQL with encrypted credentials</li><li><strong>Execution history</strong> - Full audit trail with timing and checksums</li><li><strong>Revert scripts</strong> - Rollback support when things go wrong</li></ul><p>Changes are your changelog. They document <em>how</em> to get an existing database to match your SQL files. Your SQL files remain the source of truth.</p><h2 id="when-to-use-changes" tabindex="-1">When to Use Changes <a class="header-anchor" href="#when-to-use-changes" aria-label="Permalink to “When to Use Changes”">​</a></h2><p>The distinction is simple: <strong>can you rebuild from scratch, or do you need to evolve what&#39;s there?</strong></p><p><strong>Fresh database?</strong> Run <code>noorm run build</code>. This executes your <code>sql/</code> folder—your source of truth. Tables, views, functions, seed data. Everything needed to create a working schema from nothing.</p><p><strong>Existing database with data you can&#39;t lose?</strong> Run <code>noorm change ff</code>. This applies pending changes from your <code>changes/</code> folder. Each change runs once, gets recorded in the database, and won&#39;t run again unless reverted.</p><p>Changes exist because production databases can&#39;t be rebuilt. You can&#39;t drop a table with millions of rows and recreate it. You need to <code>ALTER TABLE</code> in place, transform data carefully, add indexes without blocking writes. Changes give you:</p><ul><li><strong>Execution tracking</strong> - Know which changes have been applied</li><li><strong>Revert scripts</strong> - Roll back when something goes wrong</li><li><strong>Ordered execution</strong> - Date prefixes ensure consistent ordering across teams</li></ul><h2 id="directory-structure" tabindex="-1">Directory Structure <a class="header-anchor" href="#directory-structure" aria-label="Permalink to “Directory Structure”">​</a></h2><p>Each change lives in its own folder with a specific structure:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>changes/</span></span>
<span class="line"><span>└── 2025-01-15-add-email-verification/</span></span>
<span class="line"><span>    ├── change/                    # Forward scripts (required)</span></span>
<span class="line"><span>    │   ├── 001_create-tokens-table.sql</span></span>
<span class="line"><span>    │   └── 002_add-user-column.sql</span></span>
<span class="line"><span>    ├── revert/                    # Rollback scripts (optional)</span></span>
<span class="line"><span>    │   ├── 001_drop-user-column.sql</span></span>
<span class="line"><span>    │   └── 002_drop-tokens-table.sql</span></span>
<span class="line"><span>    └── changelog.md               # Human-readable description</span></span></code></pre></div><p><strong>change/</strong> contains your forward scripts. These run in sequence order when you apply the change.</p><p><strong>revert/</strong> contains rollback scripts. These run in forward sequence order (001, then 002), just like change scripts. You design them to undo your changes in reverse—notice how <code>001_drop-user-column</code> undoes the last change and <code>002_drop-tokens-table</code> undoes the first.</p><p><strong>changelog.md</strong> is optional but recommended. Document what the change does and why. Your future self will thank you.</p><h2 id="naming-conventions" tabindex="-1">Naming Conventions <a class="header-anchor" href="#naming-conventions" aria-label="Permalink to “Naming Conventions”">​</a></h2><p>Change folders follow the pattern <code>YYYY-MM-DD-description</code>:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>2025-01-15-add-email-verification</span></span>
<span class="line"><span>2025-02-01-migrate-user-roles</span></span>
<span class="line"><span>2025-02-14-add-search-indexes</span></span></code></pre></div><p>The date prefix ensures changes apply in chronological order across your team. When Alice creates <code>2025-01-15-add-users</code> and Bob creates <code>2025-01-16-add-posts</code>, they&#39;ll apply in the right order regardless of when they merge.</p><p>Files within <code>change/</code> and <code>revert/</code> use sequence prefixes:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>001_create-table.sql</span></span>
<span class="line"><span>002_add-column.sql</span></span>
<span class="line"><span>003_update-data.sql</span></span></code></pre></div><p>The three-digit prefix guarantees execution order. Names after the underscore are for humans.</p><h2 id="creating-a-change" tabindex="-1">Creating a Change <a class="header-anchor" href="#creating-a-change" aria-label="Permalink to “Creating a Change”">​</a></h2><p>From the TUI, navigate to changes (press <code>g</code> from home) and select add (<code>a</code>). noorm creates the folder structure for you.</p><p>In headless mode:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> add-email-verification</span></span></code></pre></div><p>This creates:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>changes/2025-01-15-add-email-verification/</span></span>
<span class="line"><span>├── change/</span></span>
<span class="line"><span>├── revert/</span></span>
<span class="line"><span>└── changelog.md</span></span></code></pre></div><p>Now add your SQL files to <code>change/</code>. If you want rollback support, add corresponding scripts to <code>revert/</code>.</p><h2 id="write-idempotent-ddl" tabindex="-1">Write Idempotent DDL <a class="header-anchor" href="#write-idempotent-ddl" aria-label="Permalink to “Write Idempotent DDL”">​</a></h2><p>Always check for existence before making changes. Use <code>IF NOT EXISTS</code> when creating, <code>IF EXISTS</code> when dropping. This protects you when:</p><ul><li>A change accidentally runs twice</li><li>Someone executes the file directly outside of noorm</li><li>You need to re-run after a partial failure</li></ul><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- change/001_add-verification-column.sql (forward)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> email_verified </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BOOLEAN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FALSE;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- revert/001_drop-verification-column.sql (rollback)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> email_verified;</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- change/001_create-tokens-table.sql (forward)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_tokens (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SERIAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    user_id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">INTEGER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> REFERENCES</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users(id),</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    token </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    expires_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TIMESTAMP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- revert/001_drop-tokens-table.sql (rollback)</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DROP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> verification_tokens;</span></span></code></pre></div><p>This applies to both forward and revert scripts. A revert that fails because &quot;column doesn&#39;t exist&quot; is just as broken as a change that fails because &quot;column already exists.&quot;</p><h2 id="file-types" tabindex="-1">File Types <a class="header-anchor" href="#file-types" aria-label="Permalink to “File Types”">​</a></h2><p>Changes support three file types:</p><h3 id="sql-files-sql" tabindex="-1">SQL Files (.sql) <a class="header-anchor" href="#sql-files-sql" aria-label="Permalink to “SQL Files (.sql)”">​</a></h3><p>Raw SQL executed directly. The most common type.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 001_add-verification-column.sql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> email_verified </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">BOOLEAN</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FALSE;</span></span></code></pre></div><h3 id="templates-sql-tmpl" tabindex="-1">Templates (.sql.tmpl) <a class="header-anchor" href="#templates-sql-tmpl" aria-label="Permalink to “Templates (.sql.tmpl)”">​</a></h3><p>Dynamic SQL processed through the Eta template engine before execution. Useful when you need conditional logic or variable substitution. See <a href="/guide/sql-files/templates.html">Templates</a> for full syntax reference.</p><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- 001_add-audit-table.sql.tmpl</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">CREATE</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> {%~ $.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">config</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">schema</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> %}.audit_log (</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    id </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">SERIAL</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> PRIMARY KEY</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    action</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TEXT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT NULL</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    created_at </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">TIMESTAMP</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> DEFAULT</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> CURRENT_TIMESTAMP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span></code></pre></div><h3 id="manifests-txt" tabindex="-1">Manifests (.txt) <a class="header-anchor" href="#manifests-txt" aria-label="Permalink to “Manifests (.txt)”">​</a></h3><p>Reference existing schema files instead of duplicating SQL. The manifest lists paths relative to your schema directory.</p><p>Many database objects use <code>CREATE OR REPLACE</code>—views, functions, procedures, triggers. They&#39;re already idempotent. When you change a table, you often need to recreate dependent views or functions. Instead of copying that SQL into your change folder, reference the source of truth:</p><div class="language-txt"><button title="Copy Code" class="copy"></button><span class="lang">txt</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span># change/001_rebuild-views.txt</span></span>
<span class="line"><span>views/user_summary.sql</span></span>
<span class="line"><span>views/active_users.sql</span></span>
<span class="line"><span>functions/get_user_stats.sql</span></span></code></pre></div><div class="language-sql"><button title="Copy Code" class="copy"></button><span class="lang">sql</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">-- change/002_add-status-column.sql</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ALTER</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> TABLE</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> users </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">ADD</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> COLUMN </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">IF</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> NOT</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> EXISTS</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> status</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> VARCHAR</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">20</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">) </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">DEFAULT</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> &#39;active&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p>Manifest files participate in ordering. Here, <code>001_rebuild-views.txt</code> runs first (recreating views that might depend on the old schema), then <code>002_add-status-column.sql</code> adds the column. You could also flip this—add the column first with <code>001_</code>, then rebuild views with <code>002_</code> so they pick up the new column.</p><p>This keeps your <code>sql/</code> folder as the single source of truth. Views and functions are defined once, referenced wherever needed.</p><h2 id="checking-change-status" tabindex="-1">Checking Change Status <a class="header-anchor" href="#checking-change-status" aria-label="Permalink to “Checking Change Status”">​</a></h2><p>From the TUI, the changes screen shows status for each change:</p><div class="language-"><button title="Copy Code" class="copy"></button><span class="lang"></span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span>┌─ Changes ─────────────────────────────────────────────┐</span></span>
<span class="line"><span>│  • 2025-01-15-add-email-verification    success       │</span></span>
<span class="line"><span>│    2025-02-01-migrate-user-roles        pending       │</span></span>
<span class="line"><span>│    2025-02-14-add-search-indexes        pending       │</span></span>
<span class="line"><span>└───────────────────────────────────────────────────────┘</span></span></code></pre></div><p>Each change has a status:</p><table tabindex="0"><thead><tr><th>Status</th><th>Meaning</th></tr></thead><tbody><tr><td><code>pending</code></td><td>Not yet applied</td></tr><tr><td><code>success</code></td><td>Applied successfully</td></tr><tr><td><code>failed</code></td><td>Last execution failed</td></tr><tr><td><code>reverted</code></td><td>Was applied, then rolled back</td></tr></tbody></table><p>In headless mode:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> list</span></span></code></pre></div><div class="language-json"><button title="Copy Code" class="copy"></button><span class="lang">json</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">{</span></span>
<span class="line"><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">    &quot;changes&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: [</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-01-15-add-email-verification&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;success&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> },</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        { </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;name&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;2025-02-01-migrate-user-roles&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">&quot;status&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">: </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&quot;pending&quot;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> }</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ]</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">}</span></span></code></pre></div><h2 id="common-workflows" tabindex="-1">Common Workflows <a class="header-anchor" href="#common-workflows" aria-label="Permalink to “Common Workflows”">​</a></h2><h3 id="apply-a-single-change" tabindex="-1">Apply a Single Change <a class="header-anchor" href="#apply-a-single-change" aria-label="Permalink to “Apply a Single Change”">​</a></h3><p>Run a specific change by name:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2025-02-01-migrate-user-roles</span></span></code></pre></div><p>From the TUI, select the change and press enter.</p><h3 id="apply-all-pending-changes" tabindex="-1">Apply All Pending Changes <a class="header-anchor" href="#apply-all-pending-changes" aria-label="Permalink to “Apply All Pending Changes”">​</a></h3><p>Fast-forward applies all pending changes in order:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> ff</span></span></code></pre></div><p>This is what you typically run in CI/CD after deployment.</p><h3 id="apply-the-next-pending-change" tabindex="-1">Apply the Next Pending Change <a class="header-anchor" href="#apply-the-next-pending-change" aria-label="Permalink to “Apply the Next Pending Change”">​</a></h3><p>Run just the next change in sequence:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> next</span></span></code></pre></div><p>Useful when you want to apply changes one at a time and verify each.</p><h3 id="revert-a-change" tabindex="-1">Revert a Change <a class="header-anchor" href="#revert-a-change" aria-label="Permalink to “Revert a Change”">​</a></h3><p>Roll back a previously applied change:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> revert</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2025-02-01-migrate-user-roles</span></span></code></pre></div><p>This runs the scripts in <code>revert/</code> in sequence order. The change status becomes <code>reverted</code>, which means it will run again on the next fast-forward.</p><h3 id="rewind-multiple-changes" tabindex="-1">Rewind Multiple Changes <a class="header-anchor" href="#rewind-multiple-changes" aria-label="Permalink to “Rewind Multiple Changes”">​</a></h3><p>Revert the last N applied changes:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> rewind</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> 3</span></span></code></pre></div><p>This reverts the three most recently applied changes, starting with the newest.</p><h3 id="preview-before-running" tabindex="-1">Preview Before Running <a class="header-anchor" href="#preview-before-running" aria-label="Permalink to “Preview Before Running”">​</a></h3><p>See what SQL will execute without running it:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2025-02-01-migrate-user-roles</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --preview</span></span></code></pre></div><p>For templates, this shows the rendered SQL. Use this before running against production.</p><h3 id="dry-run" tabindex="-1">Dry Run <a class="header-anchor" href="#dry-run" aria-label="Permalink to “Dry Run”">​</a></h3><p>Render files to a temporary directory without executing:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> 2025-02-01-migrate-user-roles</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --dry-run</span></span></code></pre></div><p>Files are written to <code>tmp/</code> so you can inspect them.</p><h2 id="when-changes-re-run" tabindex="-1">When Changes Re-Run <a class="header-anchor" href="#when-changes-re-run" aria-label="Permalink to “When Changes Re-Run”">​</a></h2><p>noorm tracks whether each change needs to run based on several conditions:</p><table tabindex="0"><thead><tr><th>Condition</th><th>What Happens</th></tr></thead><tbody><tr><td>New change folder</td><td>Runs</td></tr><tr><td>Files modified since last run</td><td>Runs</td></tr><tr><td>Previous execution failed</td><td>Runs</td></tr><tr><td>Change was reverted</td><td>Runs</td></tr><tr><td>Database was torn down</td><td>Runs (marked stale)</td></tr><tr><td><code>--force</code> flag provided</td><td>Runs</td></tr><tr><td>Successfully applied, unchanged</td><td>Skipped</td></tr></tbody></table><p>After a successful run, the change won&#39;t run again unless something changes. This is tracked via checksums of all files in <code>change/</code> or <code>revert/</code>.</p><div class="tip custom-block"><p class="custom-block-title">Force Re-Run</p><p>Need to re-apply a change? Use <code>--force</code>:</p><div class="language-bash"><button title="Copy Code" class="copy"></button><span class="lang">bash</span><pre class="shiki shiki-themes github-light github-dark" style="--shiki-light:#24292e;--shiki-dark:#e1e4e8;--shiki-light-bg:#fff;--shiki-dark-bg:#24292e;" tabindex="0" dir="ltr"><code><span class="line"><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;">noorm</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> -H</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> change</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> run</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;"> my-change</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;"> --force</span></span></code></pre></div></div><h2 id="best-practices" tabindex="-1">Best Practices <a class="header-anchor" href="#best-practices" aria-label="Permalink to “Best Practices”">​</a></h2><p><strong>One logical change per folder.</strong> Don&#39;t bundle unrelated changes. If you&#39;re adding users and adding products, make two separate changes.</p><p><strong>Always include revert scripts.</strong> Even if you think you&#39;ll never need them. Recovery is worth the extra files.</p><p><strong>Test reverts in development.</strong> Run <code>revert</code> then <code>change</code> to verify rollback works before deploying.</p><p><strong>Verify with explore and terminal.</strong> noorm includes a database explorer (<code>d</code> → <code>e</code> from home) and SQL terminal (<code>d</code> → <code>t</code>) so you can inspect your schema and query data without leaving the tool. After applying a change, explore the table to confirm the column exists. After reverting, run a quick SELECT to verify it&#39;s gone. Don&#39;t trust—verify.</p><p><strong>Use manifests for shared SQL.</strong> Reference existing schema files with <code>.txt</code> manifests instead of duplicating SQL.</p><p><strong>Preview before production.</strong> Use <code>--preview</code> or <code>--dry-run</code> to inspect exactly what will execute.</p><p><strong>Write meaningful changelog.md files.</strong> Explain <em>why</em> the change exists, not just what it does. Future debugging sessions will benefit.</p><h2 id="what-s-next" tabindex="-1">What&#39;s Next? <a class="header-anchor" href="#what-s-next" aria-label="Permalink to “What&#39;s Next?”">​</a></h2><ul><li><a href="/guide/changes/forward-revert.html">Forward &amp; Revert</a> - Applying and rolling back changes</li><li><a href="/guide/changes/history.html">History</a> - Tracking execution history</li><li><a href="/guide/sql-files/templates.html">Templates</a> - Using <code>.sql.tmpl</code> files in changes</li></ul>`,110)])])}const g=i(t,[["render",h]]);export{c as __pageData,g as default};
